<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <!--
  ArcGIS API for JavaScript, https://js.arcgis.com
  For more information about the views-switch-2d-3d sample, read the original sample description at developers.arcgis.com.
  https://developers.arcgis.com/javascript/latest/sample-code/views-switch-2d-3d/index.html
  -->
    <title>Progress Summary (SC)</title>

    <link rel="stylesheet" href="https://js.arcgis.com/4.28/esri/themes/dark/main.css" />

    <script type="module" src="https://js.arcgis.com/calcite-components/1.9.2/calcite.esm.js"></script>
    <link rel="stylesheet" type="text/css" href="https://js.arcgis.com/calcite-components/1.9.2/calcite.css" />

    <!-- Resources -->
    <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
    <script src="https://www.amcharts.com/lib/4/themes/dark.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
    <script src="https://js.arcgis.com/4.28/"></script>
</head>

<body class="calcite-mode-dark">
    <calcite-loader></calcite-loader>
    <calcite-shell content-behind>
        <div id="applicationDiv">
            <div id="headerTitleDiv">Pre-Construction Work Progress (SC)</div>
            <div class="contentBox">
                <div class="container">
                    <div class="landStrucIsfBox">
                        <div id="landChartDiv"></div>
                        <div id="landChartCountDiv"></div>
                        <div id="structureChartDiv"></div>

                    </div>
                    <div class="treeBox">
                        <div id="isfChartDiv"></div>
                        <div id="treeCuttingChartDiv"></div>
                        <div id="treeCompenChartDiv"></div>
                        <!-- <div id="treeEmptyChartDiv"></div> -->
                    </div>
                    <div class="utilityBox">
                        <div id="utilityPointChartDiv"></div>
                        <div id="utilityLineChartDiv"></div>
                        <div id="utilityEmptyChartDiv"></div>
                    </div>
                </div>
            </div>
            <div id="legendChartDiv"></div>
            <div id="dateDiv"></div>
            <div id="informationDiv"></div>
        </div>
    </calcite-shell>
</body>

<style>
    html,
    body {
        padding: 0;
        margin: 0;
    }

    #applicationDiv {
        display: flex;
        flex-wrap: wrap;
        height: 99%;
        margin: 0 auto;
        box-sizing: border-box;
        background-color: #03283f;
    }

    #informationDiv {
        position: absolute;
        z-index: 99;
        width: 30vw;
        height: 10vh;
        color: white;
        bottom: 190;
        right: 5;
        font-size: 1rem;
    }

    #informationDiv b {
        font-size: 1rem;
        color: orange;
        margin: 0;
        padding: 0;
    }

    calcite-shell {
        background-color: #03283f;
    }

    calcite-action-bar {
        position: absolute;
        z-index: 99;
        top: 0;
        right: 0;
        margin: 1rem;
    }

    calcite-panel {
        position: absolute;
        z-index: 1;
        bottom: 10px;
        right: 300px;
        width: 30vw;
        height: 50%;
    }

    calcite-loader {
        align-self: center;
        justify-self: center;
    }

    calcite-label {
        --calcite-label-margin-bottom: 0px;
    }

    .contentBox {
        display: grid;
        grid-template-columns: 80vw 17.8vw;
        width: 100%;
        height: 88vh;
    }

    .container {
        display: grid;
        flex-wrap: wrap;
        height: 88vh;
        box-sizing: border-box;
        border-right: 0;
    }

    .containerB {
        font-size: 1.5vw;
        color: white;
        padding-top: 40%;
    }

    #headerTitleDiv {
        color: white;
        font-weight: bold;
        font-size: 1.7vw;
        margin: 0.5rem;
    }

    #dateDiv {
        z-index: 99;
        position: absolute;
        padding-bottom: 10;
        font-size: 1vw;
        color: rgb(0, 197, 255);
        right: 10;
        bottom: 10;
    }

    .landStrucIsfBox,
    .treeBox {
        display: inline-flex;
        height: 29.5vh;
        width: 100%;
        box-sizing: border-box;
        border-top: 0;
        border-bottom: 0;
        margin: 0;
        padding: 0;
    }

    .utilityBox {
        display: inline-flex;
        height: 29.5vh;
        width: 100%;
        box-sizing: border-box;
        border-top: 0;
        border-bottom: 0;
        margin: 0;
        padding: 0;
    }

    #legendChartDiv {
        position: absolute;
        z-index: 99;
        right: 80;
        margin: 0;
        padding: 0;
        top: 0;
        background-color: rgba(0, 0, 0, 0);
        height: 55vh;
        width: 10vw;
    }

    #landChartDiv,
    #landChartCountDiv,
    #structureChartDiv,
    #isfChartDiv,
    #treeCuttingChartDiv,
    #treeCompenChartDiv,
    #utilityPointChartDiv,
    #utilityLineChartDiv,
    #treeEmptyChartDiv,
    #utilityEmptyChartDiv {
        width: 35%;
        height: 32vh;
        align-items: center;
        font-family: "Gill Sans", "Gill Sans MT", "Calibri", "Trebuchet MS", sans-serif;
        margin: 0;
        padding: 0;
    }

    a {
        font-size: 1.2rem;
        color: white;
        font-weight: bold;
    }

    a:hover,
    a:focus {
        color: rgb(185, 171, 171);
        font-size: 1.2vw;
    }

    ul {
        list-style: none;
        padding-left: 10;
        line-height: 3rem;
    }

    â€‹ p {
        font-size: 1rem;
        width: auto;
        vertical-align: text-bottom;
        padding: 0;
        margin-top: 0;
    }

    h2 {
        font-weight: 400;
        font-family: "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS",
            sans-serif;
        font-style: normal;
        font-size: 23px;
        color: white;
        padding: 3px;
        margin: 0px;
        width: 470px;
        vertical-align: text-top;
    }

    h3 {
        color: white;
        font-family: "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS",
            sans-serif;
        text-align: center;
        font-weight: bold;
        font-size: 14px;
        padding: 10;
        width: 100%;
    }

    h4 {
        color: rgb(0, 197, 255);
        font-family: "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS",
            sans-serif;
        text-align: left;
        font-weight: normal;
        font-size: 16px;
        padding-top: 20px;
        margin: 0;
        width: 160px;
        vertical-align: text-bottom;
    }

    h5 {
        color: rgb(0, 197, 255);
        font-family: "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS",
            sans-serif;
        text-align: center;
        font-weight: bold;
        font-size: 14px;
        padding: 3;
        margin: 10;
    }

    h6 {
        color: rgb(0, 197, 255);
        font-family: "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS",
            sans-serif;
        text-align: center;
        font-weight: normal;
        font-size: 30px;
        padding: 0px 0px 0px 0px;
    }

    .sassy-theme .esri-menu,
    .sassy-theme .esri-popup__main-container,
    .sassy-theme .esri-popup .esri-popup__pointer-direction,
    .sassy-theme .esri-popup .esri-popup__button,
    .sassy-theme .esri-button,
    .sassy-theme .esri-input,
    .sassy-theme .esri-legend,
    .sassy-theme .esri-layer-list,
    .sassy-theme .esri-widget a {
        background-color: rgb(0, 0, 0, 0.7);
        color: #fff;
    }

    .sassy-theme .esri-legend__layer-caption {
        display: none;
    }
</style>

<script>
    require([
        "esri/Basemap",
        "esri/Map",
        "esri/views/MapView",
        "esri/views/SceneView",
        "esri/layers/FeatureLayer",
        "esri/layers/support/FeatureFilter",
        "esri/layers/SceneLayer",
        "esri/layers/Layer",
        "esri/layers/TileLayer",
        "esri/layers/VectorTileLayer",
        "esri/layers/support/LabelClass",
        "esri/symbols/LabelSymbol3D",
        "esri/WebMap",
        "esri/WebScene",
        "esri/portal/PortalItem",
        "esri/portal/Portal",
        "esri/widgets/TimeSlider",
        "esri/widgets/Legend",
        "esri/widgets/LayerList",
        "esri/widgets/Fullscreen",
        "esri/rest/geometryService",
        "esri/rest/support/Query",
        "esri/rest/support/StatisticDefinition",
        "esri/symbols/WebStyleSymbol",
        "esri/TimeExtent",
        "esri/widgets/Expand",
        "esri/widgets/Editor",
        "esri/renderers/UniqueValueRenderer",
        "esri/widgets/support/DatePicker",
        "esri/widgets/FeatureTable",
        "esri/widgets/Compass",
        "esri/layers/ElevationLayer",
        "esri/Ground",
        "esri/layers/GraphicsLayer",
        "esri/widgets/Search",
    ], function (
        Basemap,
        Map,
        MapView,
        SceneView,
        FeatureLayer,
        FeatureFilter,
        SceneLayer,
        Layer,
        TileLayer,
        VectorTileLayer,
        LabelClass,
        LabelSymbol3D,
        WebMap,
        WebScene,
        PortalItem,
        Portal,
        TimeSlider,
        Legend,
        LayerList,
        Fullscreen,
        geometryService,
        Query,
        StatisticDefinition,
        WebStyleSymbol,
        TimeExtent,
        Expand,
        Editor,
        UniqueValueRenderer,
        DatePicker,
        FeatureTable,
        Compass,
        ElevationLayer,
        Ground,
        GraphicsLayer,
        Search
    ) {
        ////////////////////////////////////////////////////

        //*******************************//
        // Import Layers                 //
        //*******************************//

        var lotLayer = new FeatureLayer({
            portalItem: {
                id: "99500faf0251426ea1df934a739faa6f",
                portal: {
                    url: "https://gis.railway-sector.com/portal",
                },
            },
            layerId: 1,
            outFields: ["*"],
            title: "Status of Land Acquisition",
            labelsVisible: false,
        });

        // Structure
        var structureLayer = new FeatureLayer({
            portalItem: {
                id: "99500faf0251426ea1df934a739faa6f",
                portal: {
                    url: "https://gis.railway-sector.com/portal",
                },
            },
            layerId: 2,
            title: "Status of Structure",
            outFields: ["*"],
        });

        // Relocation Status point layer
        var reloISFLayer = new FeatureLayer({
            portalItem: {
                id: "99500faf0251426ea1df934a739faa6f",
                portal: {
                    url: "https://gis.railway-sector.com/portal",
                },
            },
            layerId: 3,
            outFields: ["*"],
            title: "Status for Relocation (ISF)",
        });
        //reloISFLayer.listMode = "hide";

        // Tree Cutting
        var treeLayer = new FeatureLayer({
            portalItem: {
                id: "dfd0bca99c754002b55459004b684415",
                portal: {
                    url: "https://gis.railway-sector.com/portal",
                },
            },
            layerId: 2,
            elevationInfo: {
                mode: "on-the-ground",
            },
            outFields: ["*"],
            title: "Status of Tree Cutting",
        });

        // Utility Relocation (Point)
        var utilPointLayer = new FeatureLayer({
            portalItem: {
                id: "b7d01020d54c4015ba0ba9454475d1dc",
                portal: {
                    url: "https://gis.railway-sector.com/portal",
                },
            },
            layerId: 1,
            title: "Utility Point",
            outFields: ["*"],
            elevationInfo: {
                mode: "on-the-ground",
            },
        });

        // Utility Relocation (Line)
        var utilLineLayer = new FeatureLayer({
            portalItem: {
                id: "b7d01020d54c4015ba0ba9454475d1dc",
                portal: {
                    url: "https://gis.railway-sector.com/portal",
                },
            },
            layerId: 2,
            title: "Utility Line",
            elevationInfo: {
                mode: "relative-to-scene",
                featureExpressionInfo: {
                    expression: "$feature.height",
                },
                unit: "meters",
                //offset: 0
            },
            outFields: ["*"],
        });

        // ************ As of Date ****************** //
        const dateTable = new FeatureLayer({
            portalItem: {
                id: 'b2a118b088a44fa0a7a84acbe0844cb2',
                portal: {
                    url: 'https://gis.railway-sector.com/portal'
                },
            },
        });

        const monthList = [
            'January',
            'February',
            'March',
            'April',
            'May',
            'June',
            'July',
            'August',
            'September',
            'October',
            'November',
            'December',
        ];

        var query = dateTable.createQuery();
        query.where = "project = 'SC'" + ' AND ' + "category = 'Progress Summary Gauge'";
        dateTable.queryFeatures(query).then((response) => {
            const stats = response.features;
            stats.forEach((result) => {
                const date = new Date(result.attributes.date);
                const year = date.getFullYear();
                const month = monthList[date.getMonth()];
                const day = date.getDate();
                const final = year < 1990 ? '' : `${month} ${day}, ${year}`;
                //console.log(date);
                document.getElementById("dateDiv").innerHTML = final;  
            })
        })

        /////////////////////////////////////////////////////////////////////
        var applicationDiv = document.getElementById("applicationDiv");

        var headerDiv = document.getElementById("headerDiv");
        var headerTitleDiv = document.getElementById("headerTitleDiv");

        // Land, structure, and ISF
        var landChartDiv = document.getElementById("landChartDiv");
        var landChartCountDiv = document.getElementById("landChartCountDiv");
        var structureChartDiv = document.getElementById("structureChartDiv");
        var isfChartDiv = document.getElementById("isfChartDiv");

        // Tree cutting and tree compensation
        var treeCuttingChartDiv = document.getElementById("treeCuttingChartDiv");
        var treeCompenChartDiv = document.getElementById("treeCompenChartDiv");

        // Utitlity Relocation
        var utilityPointChartDiv = document.getElementById("utilityPointChartDiv");
        var utilityLineChartDiv = document.getElementById("utilityLineChartDiv");

        var informationDiv = document.getElementById("informationDiv");

        //informationDiv.innerHTML =  "<br>" + "<b>" + "Note:" + "</b>" + "<br>" + "<br>" + "* Each gauge shows percent progress of each CP in the sliced chart.";
        // informationDiv.innerHTML = `<b>Note:</b><br>
        //                           <p>1. The progress of individual CPs is indicated in the sliced areas of gauges.</p>
        //                           <p>2. Values in the parentheses represent the total number of observations or total area (m2).
        //                           `;

        // Thousand separators function
        function thousands_separators(num) {
            var num_parts = num.toString().split(".");
            num_parts[0] = num_parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            return num_parts.join(".");
        }

        // *********************************************** //

        ////////// Chart Begins //////////////////
        am4core.ready(function () {
            am4core.useTheme(am4themes_animated);

            const axis1TickColor = "#C5C5C5";
            // Color Definition
            const color_101 = "#ffa500";
            const color_102 = "#ff69b4";
            const color_103a = "#00ff00";
            const color_103b = "#70AD47";
            const color_103c = "#088f8f";
            const color_104 = "#ffff00";
            const color_105 = "#bf40bf";
            const color_106 = "#ff7f7f";
            const color_107 = "#cdaa66";
            const color_handedOver = "#00c5ff";

            // Bottom Title Color
            const BOTTOM_LABEL_COL = am4core.color("#C5C5C5");
            const TOP_TITLE_COL = am4core.color("#FFFFFF");

            // Gauge Needle (hand) length
            const NEEDLE_LENGTH = am4core.percent(70);

            const bottomLabelFontSize = "1.3em";
            const titleFontSize = "1.7em";
            const labelMarginTop = -5;

            // Total percent and total number label properties
            const totalPercentLabel_y = -15;
            const totalPercentLabel_fontSize = "3.5em";

            const totalNumberLabel_y = 5;
            const totalNumberLabel_fontSize = "1.5em";

            /// Themes begin ///

            // Legend //
            function legendCP() {
                var total_s01_lot = {
                    onStatisticField: "CASE WHEN CP = 'S-01' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01_lot",
                    statisticType: "sum",
                };

                var total_s02_lot = {
                    onStatisticField: "CASE WHEN CP = 'S-02' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02_lot",
                    statisticType: "sum",
                };

                var total_s03a_lot = {
                    onStatisticField: "CASE WHEN CP = 'S-03a' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a_lot",
                    statisticType: "sum",
                };

                var total_s03b_lot = {
                    onStatisticField: "CASE WHEN CP = 'S-03b' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b_lot",
                    statisticType: "sum",
                };

                var total_s03c_lot = {
                    onStatisticField: "CASE WHEN CP = 'S-03c' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c_lot",
                    statisticType: "sum",
                };


                var total_s04_lot = {
                    onStatisticField: "CASE WHEN CP = 'S-04' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04_lot",
                    statisticType: "sum",
                };

                var total_s05_lot = {
                    onStatisticField: "CASE WHEN CP = 'S-05' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05_lot",
                    statisticType: "sum",
                };

                var total_s06_lot = {
                    onStatisticField: "CASE WHEN CP = 'S-06' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06_lot",
                    statisticType: "sum",
                }

                var total_s07_lot = {
                    onStatisticField: "CASE WHEN CP = 'S-07' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07_lot",
                    statisticType: "sum",
                }

                var query = lotLayer.createQuery();
                query.outStatistics = [
                    total_s01_lot,
                    total_s02_lot,
                    total_s03a_lot,
                    total_s03b_lot,
                    total_s03c_lot,
                    total_s04_lot,
                    total_s05_lot,
                    total_s06_lot,
                    total_s07_lot,
                ];
                // query.returnGeometry = true;

                return lotLayer.queryFeatures(query).then(function (response) {
                    var stats = response.features[0].attributes;

                    const s01 = stats.total_s01_lot;
                    const s02 = stats.total_s02_lot;
                    const s03a = stats.total_s03a_lot;
                    const s03b = stats.total_s03b_lot;
                    const s03c = stats.total_s03c_lot;
                    const s04 = stats.total_s04_lot;
                    const s05 = stats.total_s05_lot;
                    const s06 = stats.total_s06_lot;
                    const s07 = stats.total_s07_lot;

                    var chart = am4core.create("legendChartDiv", am4charts.PieChart);

                    // Add data
                    chart.data = [
                        {
                            CP: "All CPs",
                            status: 0,
                            color: am4core.color(color_handedOver),
                        },
                        {
                            CP: "CP S-01 (%)",
                            status: s01,
                            color: am4core.color(color_101),
                        },
                        {
                            CP: "CP S-02 (%)",
                            status: s02,
                            color: am4core.color(color_102),
                        },
                        {
                            CP: "CP S-03A (%)",
                            status: s03a,
                            color: am4core.color(color_103a),
                        },
                        {
                            CP: "CP S-03B (%)",
                            status: s03b,
                            color: am4core.color(color_103b),
                        },
                        {
                            CP: "CP S-03C (%)",
                            status: s03c,
                            color: am4core.color(color_103c),
                        },
                        {
                            CP: "CP S-04 (%)",
                            status: s04,
                            color: am4core.color(color_104),
                        },
                        {
                            CP: "CP S-05 (%)",
                            status: s05,
                            color: am4core.color(color_105),
                        },
                        {
                            CP: "CP S-06 (%)",
                            status: s06,
                            color: am4core.color(color_106),
                        },
                        {
                            CP: "CP S-07 (%)",
                            status: s07,
                            color: am4core.color(color_107),
                        },
                    ];

                    // Set inner radius
                    chart.innerRadius = am4core.percent(0);
                    chart.radius = am4core.percent(0);
                    // Add and configure Series

                    function createSlices(field, status) {
                        var pieSeries = chart.series.push(new am4charts.PieSeries());
                        pieSeries.dataFields.value = field;
                        pieSeries.dataFields.category = status;
                        pieSeries.disabled = true;
                        pieSeries.slices.template.propertyFields.fill = "color";
                        pieSeries.slices.template.stroke = am4core.color("#fff");
                        pieSeries.slices.template.strokeWidth = 0;
                        pieSeries.slices.template.strokeOpacity = 1;

                        // change the cursor on hover to make it apparent the object can be interacted with
                        pieSeries.slices.template.cursorOverStyle = [
                            {
                                property: "cursor",
                                value: "pointer",
                            },
                        ];

                        // Add a legend
                        const LegendFontSizze = "1em";
                        chart.legend = new am4charts.Legend();

                        chart.legend.valueLabels.template.align = "right";
                        chart.legend.valueLabels.template.textAlign = "end";

                        //chart.legend.position = "bottom";
                        chart.legend.labels.template.fontSize = LegendFontSizze;
                        chart.legend.labels.template.fill = "#ffffff";
                        chart.legend.valueLabels.template.fill = am4core.color("#ffffff");

                        //pieSeries.legendSettings.valueText = "{value.percent.formatNumber('#.')}% ({value})";
                        //pieSeries.legendSettings.labelText = "Series: [bold {color}]{category}[/]";

                        // Responsive code for chart
                        chart.responsive.enabled = true;
                        chart.responsive.useDefault = false;
                        chart.logo.disabled = true;

                        chart.responsive.rules.push({
                            relevant: function (target) {
                                if (target.pixelWidth <= 400) {
                                    return true;
                                }
                                return false;
                            },
                            state: function (target, stateId) {
                                if (target instanceof am4charts.PieSeries) {
                                    var state = target.states.create(stateId);

                                    var labelState =
                                        target.labels.template.states.create(stateId);
                                    labelState.properties.disabled = true;

                                    var tickState =
                                        target.ticks.template.states.create(stateId);
                                    tickState.properties.disabled = true;
                                    return state;
                                }
                                if (target instanceof am4charts.Legend) {
                                    var state = target.states.create(stateId);
                                    state.properties.paddingTop = 0;
                                    state.properties.paddingRight = 0;
                                    state.properties.paddingBottom = 0;
                                    state.properties.paddingLeft = 0;
                                    state.properties.marginLeft = 0;
                                    return state;
                                }
                                return null;
                            },
                        });
                        // Responsive code for chart

                        // Chart Title
                        //var title = chart.titles.create();
                        //title.text = "Land"; // [#00ff00]world[/], Hello [font-size: 30px]world[/]
                        //title.fontSize = 20;
                        //title.fontWeight = "bold";
                        //title.fill = "#ffffff";
                        //title.marginTop = 5;

                        var marker = chart.legend.markers.template.children.getIndex(0);
                        var markerTemplate = chart.legend.markers.template;
                        //marker.cornerRadius(12, 12, 12, 12); round legend marker
                        marker.strokeWidth = 1;
                        marker.strokeOpacity = 1;
                        marker.stroke = am4core.color("#ccc");

                        // Change size of legend marker
                        markerTemplate.width = 18;
                        markerTemplate.height = 18;
                        // This creates initial animation
                        //pieSeries.hiddenState.properties.opacity = 1;
                        //pieSeries.hiddenState.properties.endAngle = -90;
                        //pieSeries.hiddenState.properties.startAngle = -90;
                    } // End of createSlices function

                    createSlices("status", "CP");
                }); // End of queryFeatures
            } // End of updateChartLot()
            legendCP();



            // Calculate Statistcis
            // Land, Structure, and ISF

            //////////////////////////////////////////

            //////////////////////////////////////////

            //////////////// 1. Land (Handed-Over Area) ////////////////
            // Note that we need the following:
            // 1. total handed over %
            // 2. weighted handed over % for each CP [this is used for dividing bar areas = visualization purpose]
            // 3. actual handed over % for each CP [this number is used for annotation]

            // function totalLotHandedOverArea() {
            //     var total_affected_area = {
            //         onStatisticField: "AffectedArea",
            //         outStatisticFieldName: "total_affected_area",
            //         statisticType: "sum",
            //     };

            //     var total_handover_area = {
            //         onStatisticField: "HandedOverArea",
            //         outStatisticFieldName: "total_handover_area",
            //         statisticType: "sum",
            //     };

            //     var total_s01 = {
            //         onStatisticField:
            //             "CASE WHEN (HandedOver = 1 and CP = 'S-01') THEN 1 ELSE 0 END",
            //         outStatisticFieldName: "total_s01_handedover",
            //         statisticType: "sum",
            //     }
            // }

            // function totalLotHandedOverArea() {

            // }









            const queryTotalHandedOver =
                "(CP IS NOT NULL OR AffectedArea IS NOT NULL) AND CP NOT IN ('S-03B, S-03C')";

            function lotTotalArea() {
                var total_affected_area = {
                    onStatisticField: "AffectedArea",
                    outStatisticFieldName: "total_affected_area",
                    statisticType: "sum",
                };

                var query = lotLayer.createQuery();
                query.where = queryTotalHandedOver;
                query.outStatistics = [total_affected_area];

                return lotLayer.queryFeatures(query).then(function (response) {
                    var stats = response.features[0].attributes;

                    const totalAffected = stats.total_affected_area;
                    return totalAffected;
                }); 
            }

            function lotSummary(totalAffected) {
                var total_affected_area = {
                    onStatisticField: "AffectedArea",
                    outStatisticFieldName: "total_affected_area",
                    statisticType: "sum",
                };

                var total_handover_area = {
                    onStatisticField: "HandedOverArea",
                    outStatisticFieldName: "total_handover_area",
                    statisticType: "sum",
                };

                var query = lotLayer.createQuery();
                query.outStatistics = [total_affected_area, total_handover_area];
                query.where = queryTotalHandedOver;
                query.orderByFields = ["CP"];
                query.groupByFieldsForStatistics = ["CP"];

                var cpS01 = [];
                var cpS01_a = [];

                var cpS02 = [];
                var cpS02_a = [];

                var cpS03A = [];
                var cpS03A_a = [];

                var cpS03B = [];
                var cpS03B_a = [];

                var cpS03C = [];
                var cpS03C_a = [];

                var cpS04 = [];
                var cpS04_a = [];

                var cpS05 = [];
                var cpS05_a = [];

                var cpS06 = [];
                var cpS06_a = [];

                var cpS07 = [];
                var cpS07_a = [];

                return lotLayer.queryFeatures(query).then(function (response) {
                    stats = response.features;

                    stats.forEach((result, index) => {
                        const attributes = result.attributes;
                        const cpPackage = result.attributes.CP;
                        const affected = attributes.total_affected_area;
                        const handedOver = attributes.total_handover_area;
                        //const handedOver = attributes.total_handover_area > affected ? 5000 : attributes.total_handover_area;
                        const LOT_HANDOVER_PERC = (handedOver / totalAffected) * 100;
                        const lot_handedover = (handedOver / affected) * 100;

                        //console.log(LOT_HANDOVER_PERC);
                        // console.log(lot_handedover);
                        if (cpPackage === "S-01") {
                            cpS01.push(LOT_HANDOVER_PERC);
                            cpS01_a.push(lot_handedover);
                        } else if (cpPackage === "S-02") {
                            cpS02.push(LOT_HANDOVER_PERC);
                            cpS02_a.push(lot_handedover);
                        } else if (cpPackage === "S-03A") {
                            cpS03A.push(LOT_HANDOVER_PERC);
                            cpS03A_a.push(lot_handedover);
                        } else if (cpPackage === "S-03B") {
                            cpS03B.push(LOT_HANDOVER_PERC);
                            cpS03B_a.push(lot_handedover);
                        } else if (cpPackage === "S-03C") {
                            cpS03C.push(LOT_HANDOVER_PERC);
                            cpS03C_a.push(lot_handedover);
                        } else if (cpPackage === "S-04") {
                            cpS04.push(LOT_HANDOVER_PERC);
                            cpS04_a.push(lot_handedover);
                        } else if (cpPackage === "S-05") {
                            cpS05.push(LOT_HANDOVER_PERC);
                            cpS05_a.push(lot_handedover);
                        } else if (cpPackage === "S-06") {
                            cpS06.push(LOT_HANDOVER_PERC);
                            cpS06_a.push(lot_handedover);
                        } else if (cpPackage === "S-07") {
                            cpS07.push(LOT_HANDOVER_PERC);
                            cpS07_a.push(lot_handedover);
                        }
                    });
                    return [
                        cpS01,
                        cpS02,
                        cpS03A,
                        cpS03B,
                        cpS03C,
                        cpS04,
                        cpS05,
                        cpS06,
                        cpS07,
                        cpS01_a,
                        cpS02_a,
                        cpS03A_a,
                        cpS03B_a,
                        cpS03C_a,
                        cpS04_a,
                        cpS05_a,
                        cpS06_a,
                        cpS07_a,
                        totalAffected,
                    ]; 
                });
            } // End of lotSummary function

            function laFigureLot([
                cpS01,
                cpS02,
                cpS03A,
                cpS03B,
                cpS03C,
                cpS04,
                cpS05,
                cpS06,
                cpS07,
                cpS01_a,
                cpS02_a,
                cpS03A_a,
                cpS03B_a,
                cpS03C_a,
                cpS04_a,
                cpS05_a,
                cpS06_a,
                cpS07_a,
                totalAffected,
            ]) {
                var totalScore = // sum of weighted handed-over %
                    Number(cpS01) +
                    Number(cpS02) +
                    Number(cpS03A) +
                    Number(cpS03B) +
                    Number(cpS03C) +
                    Number(cpS04) +
                    Number(cpS05) +
                    Number(cpS06) +
                    Number(cpS07);

                // Weighted handed over % for each CP for dividing bars (visualization purpose)
                var S01 = Number(cpS01);
                var S02 = S01 + Number(cpS02);
                var S03a = S02 + Number(cpS03A);
                var S03b = S03a + Number(cpS03B);
                var S03c = S03b + Number(cpS03C);
                var S04 = S03c + Number(cpS04);
                var S05 = S04 + Number(cpS05);
                var S06 = S05 + Number(cpS06);
                var S07 = S06 + Number(cpS07);

                var s01 = Number(cpS01_a);
                var s02 = Number(cpS02_a);
                var s03a = Number(cpS03A_a);
                var s03b = Number(cpS03B_a);
                var s03c = Number(cpS03C_a);
                var s04 = Number(cpS04_a);
                var s05 = Number(cpS05_a);
                var s06 = Number(cpS06_a);
                var s07 = Number(cpS07_a);

                var chartMin = 0;
                var chartMax = 100;

                // #ffea8c|#b3ab60|#4b595e|#6693c8|#aadbff
                // const colors = ["#ffea8c", "#b3ab60", "#4b595e", "#6693c8", "#aadbff"];

                var data = {
                    score: totalScore,
                    gradingData: [
                        {
                            title: s01.toFixed(0),
                            color: color_101,
                            lowScore: 0,
                            highScore: S01,
                        },
                        {
                            title: s02.toFixed(0),
                            color: color_102,
                            lowScore: S01,
                            highScore: S02,
                        },
                        {
                            title: s03a.toFixed(0),
                            color: color_103a,
                            lowScore: S02,
                            highScore: S03a,
                        },
                        {
                            title: s03b.toFixed(0),
                            color: color_103b,
                            lowScore: S03a,
                            highScore: S03b,
                        },
                        {
                            title: s03c.toFixed(0),
                            color: color_103c,
                            lowScore: S03b,
                            highScore: S03c,
                        },
                        {
                            title: s04.toFixed(0),
                            color: color_104,
                            lowScore: S03c,
                            highScore: S04,
                        },
                        {
                            title: s05.toFixed(0),
                            color: color_105,
                            lowScore: S04,
                            highScore: S05,
                        },
                        {
                            title: s06.toFixed(0),
                            color: color_106,
                            lowScore: S05,
                            highScore: S06,
                        },
                        {
                            title: s07.toFixed(0),
                            color: color_107,
                            lowScore: S06,
                            highScore: S07,
                        },
                        {
                            title: "",
                            color: "#C5C5C5",
                            lowScore: S07,
                            highScore: 100,
                        },
                    ],
                };

                /**
          Grading Lookup
          */
                function lookUpGrade(lookupScore, grades) {
                    // Only change code below this line
                    for (var i = 0; i < grades.length; i++) {
                        if (
                            grades[i].lowScore < lookupScore &&
                            grades[i].highScore >= lookupScore
                        ) {
                            return grades[i];
                        }
                    }
                    return null;
                }

                // create chart
                var chart = am4core.create("landChartDiv", am4charts.GaugeChart);
                chart.hiddenState.properties.opacity = 0;
                chart.fontSize = 11;
                chart.innerRadius = am4core.percent(80);
                chart.resizable = true;
                chart.responsive.enabled = true;
                chart.logo.disabled = true;
                /**
                 * Chart Title
                 */
                // Title Color
                var title = chart.titles.create();
                //'<a href="https://google.com"}">More info</a>'

                title.text = "LAND";
                //title.html = '<a href="https://eijigorilla.github.io/WebApp/ArcGIS_API_for_JavaScript/envi/Operational/N2_Land_Structure2/index2.html" target="_blank">LAND</a>';
                title.fontSize = titleFontSize;
                title.align = "center";
                title.marginBottom = -10;
                title.marginTop = 0;
                title.fill = TOP_TITLE_COL;

                //var sourceLabel = chart.createChild(am4core.Label);
                //sourceLabel.html = '<a href="https://google.com">Test</a>';

                // Add bottom label
                var label = chart.chartContainer.createChild(am4core.Label);
                label.text = "[bold]HANDED-OVER AREA";
                //label.html = '<a href="https://google.com">HANDED-OVER AREA</a>';
                label.fontSize = bottomLabelFontSize;
                label.align = "center";
                label.marginTop = labelMarginTop;
                label.fill = BOTTOM_LABEL_COL;

                /**
                 * Normal axis
                 */

                var axis = chart.xAxes.push(new am4charts.ValueAxis());
                axis.min = chartMin;
                axis.max = chartMax;
                axis.strictMinMax = true;
                axis.renderer.radius = am4core.percent(80);
                axis.renderer.inside = true;
                axis.renderer.line.strokeOpacity = 0.5; // line opacity inside curve line
                axis.renderer.ticks.template.disabled = false;
                axis.renderer.ticks.template.strokeOpacity = 1;
                //axis.renderer.ticks.template.strokeWidth = 1;
                axis.renderer.ticks.template.length = 10;
                axis.renderer.ticks.template.stroke = am4core.color(axis1TickColor);
                //axis.renderer.grid.template.disabled = true;
                axis.renderer.labels.template.radius = am4core.percent(40);
                axis.renderer.labels.template.fontSize = "1.2em"; // default: 1.2em inner radius axis percent labels (0 to 100%)
                axis.renderer.labels.template.fill = am4core.color(axis1TickColor);

                /**
                 * Axis for ranges
                 */

                var axis2 = chart.xAxes.push(new am4charts.ValueAxis());
                axis2.min = chartMin;
                axis2.max = chartMax;
                axis2.strictMinMax = true;
                axis2.renderer.labels.template.disabled = true;
                axis2.renderer.ticks.template.disabled = true;
                axis2.renderer.grid.template.disabled = true; // when true inside tick marks will disappear
                axis2.renderer.grid.template.opacity = 0.5;
                axis2.renderer.labels.template.bent = true;
                axis2.renderer.labels.template.fill = am4core.color("#000");
                axis2.renderer.labels.template.fontWeight = "bold";
                axis2.renderer.labels.template.fillOpacity = 0.7;

                /**
            Ranges
            */

                for (let grading of data.gradingData) {
                    var range = axis2.axisRanges.create();
                    range.axisFill.fill = am4core.color(grading.color);
                    range.axisFill.fillOpacity = 1; // default 0.8 fill-color of
                    range.axisFill.zIndex = -1;
                    range.value =
                        grading.lowScore > chartMin ? grading.lowScore : chartMin;
                    range.endValue =
                        grading.highScore < chartMax ? grading.highScore : chartMax;
                    range.grid.strokeOpacity = 0; // changes opacity of inside tick mark
                    range.stroke = am4core.color(grading.color).lighten(-0.1);
                    range.label.inside = true;
                    range.label.text = grading.title.toUpperCase();
                    range.label.inside = true;
                    range.label.location = 0.5;
                    range.label.inside = true;
                    range.label.radius = am4core.percent(10);
                    range.label.paddingBottom = -5; // ~half font size
                    range.label.fontSize = "1.4em"; // category label (i.e., N-01, N-02, ....)
                }

                var matchingGrade = lookUpGrade(data.score, data.gradingData);

                /**
                 * Label 1 (total Percent)
                 */

                var label = chart.radarContainer.createChild(am4core.Label);
                label.isMeasured = false;
                label.fontSize = totalPercentLabel_fontSize;
                label.x = am4core.percent(50);
                label.y = totalPercentLabel_y;
                label.paddingBottom = -5;
                label.horizontalCenter = "middle";
                label.verticalCenter = "bottom";
                //label.dataItem = data;
                label.text = data.score.toFixed(0).toString() + "%";
                //label.text = "{score}";
                //label.fill = am4core.color(matchingGrade.color);
                label.fill = am4core.color("#00C3FF");

                /**
                 * Label 2
                 */


                var label2 = chart.radarContainer.createChild(am4core.Label);
                label2.isMeasured = false;
                label2.fontSize = totalNumberLabel_fontSize;
                label2.horizontalCenter = "middle";
                label2.verticalCenter = "bottom";
                label2.y = totalNumberLabel_y;
                label2.text =
                    "(" + thousands_separators(totalAffected.toFixed(0)) + ")";
                label2.fill = am4core.color("#00C3FF");

                /**
                 * Hand
                 */

                var hand = chart.hands.push(new am4charts.ClockHand());
                hand.axis = axis2;
                hand.innerRadius = am4core.percent(55);
                hand.startWidth = 8;
                hand.pin.disabled = true;
                hand.value = data.score;
                hand.fill = am4core.color("#000000"); // inner color of needle
                //hand.stroke = am4core.color("#000");
                hand.fillOpacity = 0.5;

                /*
          hand.events.on("positionchanged", function(){
          label.text = axis2.positionToValue(hand.currentPosition).toFixed(0).toString() + "%";
          var value2 = axis.positionToValue(hand.currentPosition);
          var matchingGrade = lookUpGrade(axis.positionToValue(hand.currentPosition), data.gradingData);
          label2.text = matchingGrade.title.toUpperCase();
          label2.fill = am4core.color(matchingGrade.color);
          label2.stroke = am4core.color(matchingGrade.color);
          label.fill = am4core.color(matchingGrade.color);
          })
          */
                /*
          setInterval(function() {
          var value = chartMin + Math.random() * (chartMax - chartMin);
          hand.showValue(value, 1000, am4core.ease.cubicOut);
          }, 2000);
          */
            }
            lotTotalArea().then(lotSummary).then(laFigureLot);


            //////////////// 2. Land (Handed-Over Counts) ////////////////
            function totalLotCount() {
                var total_lot = {
                    onStatisticField: "LotID",
                    outStatisticFieldName: "total_lot",
                    statisticType: "count",
                };

                var total_handedover = {
                    onStatisticField: "CASE WHEN HandedOver = 1 THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_handedover",
                    statisticType: "sum",
                };

                var total_s01 = {
                    onStatisticField: "CASE WHEN CP = 'S-01' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01",
                    statisticType: "sum",
                };

                var total_s01_handedover = {
                    onStatisticField:
                        "CASE WHEN (HandedOver = 1 and CP = 'S-01') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01_handedover",
                    statisticType: "sum",
                };

                var total_s02 = {
                    onStatisticField: "CASE WHEN CP = 'S-02' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02",
                    statisticType: "sum",
                };

                var total_s02_handedover = {
                    onStatisticField:
                        "CASE WHEN (HandedOver = 1 and CP = 'S-02') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02_handedover",
                    statisticType: "sum",
                };

                var total_s03a = {
                    onStatisticField: "CASE WHEN CP = 'S-03a' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a",
                    statisticType: "sum",
                };

                var total_s03a_handedover = {
                    onStatisticField:
                        "CASE WHEN (HandedOver = 1 and CP = 'S-03a') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a_handedover",
                    statisticType: "sum",
                };

                var total_s03b = {
                    onStatisticField: "CASE WHEN CP = 'S-03b' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b",
                    statisticType: "sum",
                };

                var total_s03b_handedover = {
                    onStatisticField:
                        "CASE WHEN (HandedOver = 1 and CP = 'S-03b') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b_handedover",
                    statisticType: "sum",
                };

                var total_s03c = {
                    onStatisticField: "CASE WHEN CP = 'S-03c' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c",
                    statisticType: "sum",
                };

                var total_s03c_handedover = {
                    onStatisticField:
                        "CASE WHEN (HandedOver = 1 and CP = 'S-03c') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c_handedover",
                    statisticType: "sum",
                };

                var total_s04 = {
                    onStatisticField: "CASE WHEN CP = 'S-04' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04",
                    statisticType: "sum",
                };

                var total_s04_handedover = {
                    onStatisticField:
                        "CASE WHEN (HandedOver = 1 and CP = 'S-04') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04_handedover",
                    statisticType: "sum",
                };

                var total_s05 = {
                    onStatisticField: "CASE WHEN CP = 'S-05' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05",
                    statisticType: "sum",
                };

                var total_s05_handedover = {
                    onStatisticField:
                        "CASE WHEN (HandedOver = 1 and CP = 'S-05') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05_handedover",
                    statisticType: "sum",
                };

                var total_s06 = {
                    onStatisticField: "CASE WHEN CP = 'S-06' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06",
                    statisticType: "sum",
                };

                var total_s06_handedover = {
                    onStatisticField:
                        "CASE WHEN (HandedOver = 1 and CP = 'S-06') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06_handedover",
                    statisticType: "sum",
                };

                var total_s07 = {
                    onStatisticField: "CASE WHEN CP = 'S-07' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07",
                    statisticType: "sum",
                };

                var total_s07_handedover = {
                    onStatisticField:
                        "CASE WHEN (HandedOver = 1 and CP = 'S-07') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07_handedover",
                    statisticType: "sum",
                };


                var query = lotLayer.createQuery();
                query.outStatistics = [
                    total_lot,
                    total_handedover,
                    total_s01,
                    total_s01_handedover,
                    total_s02,
                    total_s02_handedover,
                    total_s03a,
                    total_s03a_handedover,
                    total_s03b,
                    total_s03b_handedover,
                    total_s03c,
                    total_s03c_handedover,
                    total_s04,
                    total_s04_handedover,
                    total_s05,
                    total_s05_handedover,
                    total_s06,
                    total_s06_handedover,
                    total_s07,
                    total_s07_handedover,
                ];

                return lotLayer.queryFeatures(query).then((response) => {
                    var stats = response.features[0].attributes;
                    const total = stats.total_lot;
                    const handedOver = stats.total_handedover;
                    const percent = (handedOver / total) * 100;

                    const s01_total = stats.total_s01;
                    const s02_total = stats.total_s02;
                    const s03a_total = stats.total_s03a;
                    const s03b_total = stats.total_s03b;
                    const s03c_total = stats.total_s03c;
                    const s04_total = stats.total_s04;
                    const s05_total = stats.total_s05;
                    const s06_total = stats.total_s06;
                    const s07_total = stats.total_s07;

                    console.log(s03a_total); 

                    const s01_total_handedover = stats.total_s01_handedover;
                    const s02_total_handedover = stats.total_s02_handedover;
                    const s03a_total_handedover = stats.total_s03a_handedover;
                    const s03b_total_handedover = stats.total_s03b_handedover;
                    const s03c_total_handedover = stats.total_s03c_handedover;
                    const s04_total_handedover = stats.total_s04_handedover;
                    const s05_total_handedover = stats.total_s05_handedover;
                    const s06_total_handedover = stats.total_s06_handedover;
                    const s07_total_handedover = stats.total_s07_handedover;

                    const s01_percent =
                        s01_total === 0 ? 0 : (s01_total_handedover / s01_total) * 100;
                    const s02_percent =
                        s02_total === 0 ? 0 : (s02_total_handedover / s02_total) * 100;
                    const s03a_percent =
                        s03a_total === 0 ? 0 : (s03a_total_handedover / s03a_total) * 100;
                    const s03b_percent =
                        s03b_total === 0 ? 0 : (s03b_total_handedover / s03b_total) * 100;
                    const s03c_percent =
                        s03c_total === 0 ? 0 : (s03c_total_handedover / s03c_total) * 100;
                    const s04_percent =
                        s04_total === 0 ? 0 : (s04_total_handedover / s04_total) * 100;
                    const s05_percent =
                        s05_total === 0 ? 0 : (s05_total_handedover / s05_total) * 100;
                    const s06_percent =
                        s06_total === 0 ? 0 : (s06_total_handedover / s06_total) * 100;
                    const s07_percent =
                        s07_total === 0 ? 0 : (s07_total_handedover / s07_total) * 100;

                    const s01_percent_total = (s01_total_handedover / total) * 100;
                    const s02_percent_total = (s02_total_handedover / total) * 100;
                    const s03a_percent_total = (s03a_total_handedover / total) * 100;
                    const s03b_percent_total = (s03b_total_handedover / total) * 100;
                    const s03c_percent_total = (s03c_total_handedover / total) * 100;
                    const s04_percent_total = (s04_total_handedover / total) * 100;
                    const s05_percent_total = (s05_total_handedover / total) * 100;
                    const s06_percent_total = (s06_total_handedover / total) * 100;
                    const s07_percent_total = (s07_total_handedover / total) * 100;

                    return [
                        total,
                        percent,
                        s01_percent,
                        s02_percent,
                        s03a_percent,
                        s03b_percent,
                        s03c_percent,
                        s04_percent,
                        s05_percent,
                        s06_percent,
                        s07_percent,
                        s01_percent_total,
                        s02_percent_total,
                        s03a_percent_total,
                        s03b_percent_total,
                        s03c_percent_total,
                        s04_percent_total,
                        s05_percent_total,
                        s06_percent_total,
                        s07_percent_total,
                    ];
                });
            }

            function chartTotalLotHandedOverCount([
                total,
                percent,
                s01_percent,
                s02_percent,
                s03a_percent,
                s03b_percent,
                s03c_percent,
                s04_percent,
                s05_percent,
                s06_percent,
                s07_percent,
                s01_percent_total,
                s02_percent_total,
                s03a_percent_total,
                s03b_percent_total,
                s03c_percent_total,
                s04_percent_total,
                s05_percent_total,
                s06_percent_total,
                s07_percent_total,
            ]) {
                var totalScore = percent;

                var S01 = s01_percent_total;
                var S02 = s01_percent_total + s02_percent_total;
                var S03a = s01_percent_total + s02_percent_total + s03a_percent_total;
                var S03b =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total;
                var S03c =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total;
                var S04 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total;
                var S05 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total;
                var S06 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total +
                    s06_percent_total;
                var S07 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total +
                    s06_percent_total +
                    s07_percent_total;

                var chartMin = 0;
                var chartMax = 100;

                // #ffea8c|#b3ab60|#4b595e|#6693c8|#aadbff
                // const colors = ["#ffea8c", "#b3ab60", "#4b595e", "#6693c8", "#aadbff"];

                var data = {
                    score: totalScore,
                    gradingData: [
                        {
                            title: s01_percent.toFixed(0),
                            color: color_101,
                            lowScore: 0,
                            highScore: S01,
                        },
                        {
                            title: s02_percent.toFixed(0),
                            color: color_102,
                            lowScore: S01,
                            highScore: S02,
                        },
                        {
                            title: s03a_percent.toFixed(0),
                            color: color_103a,
                            lowScore: S02,
                            highScore: S03a,
                        },
                        {
                            title: s03b_percent.toFixed(0),
                            color: color_103b,
                            lowScore: S03a,
                            highScore: S03b,
                        },
                        {
                            title: s03c_percent.toFixed(0),
                            color: color_103c,
                            lowScore: S03b,
                            highScore: S03c,
                        },
                        {
                            title: s04_percent.toFixed(0),
                            color: color_104,
                            lowScore: S03c,
                            highScore: S04,
                        },
                        {
                            title: s05_percent.toFixed(0),
                            color: color_105,
                            lowScore: S04,
                            highScore: S05,
                        },
                        {
                            title: s06_percent.toFixed(0),
                            color: color_106,
                            lowScore: S05,
                            highScore: S06,
                        },
                        {
                            title: s07_percent.toFixed(0),
                            color: color_107,
                            lowScore: S06,
                            highScore: S07,
                        },
                        {
                            title: "",
                            color: "#C5C5C5",
                            lowScore: S07,
                            highScore: 100,
                        },
                    ],
                };

                /**
          Grading Lookup
          */
                function lookUpGrade(lookupScore, grades) {
                    // Only change code below this line
                    for (var i = 0; i < grades.length; i++) {
                        if (
                            grades[i].lowScore < lookupScore &&
                            grades[i].highScore >= lookupScore
                        ) {
                            return grades[i];
                        }
                    }
                    return null;
                }

                // create chart
                var chart = am4core.create("landChartCountDiv", am4charts.GaugeChart);
                chart.hiddenState.properties.opacity = 0;
                chart.fontSize = 11;
                chart.innerRadius = am4core.percent(80);
                chart.resizable = true;
                chart.responsive.enabled = true;
                chart.logo.disabled = true;
                /**
                 * Chart Title
                 */
                // Title Color
                var title = chart.titles.create();
                //'<a href="https://google.com"}">More info</a>'

                title.text = "LAND";
                //title.html = '<a href="https://eijigorilla.github.io/WebApp/ArcGIS_API_for_JavaScript/envi/Operational/N2_Land_Structure2/index2.html" target="_blank">LAND</a>';
                title.fontSize = titleFontSize;
                title.align = "center";
                title.marginBottom = -10;
                title.marginTop = 0;
                title.fill = TOP_TITLE_COL;

                //var sourceLabel = chart.createChild(am4core.Label);
                //sourceLabel.html = '<a href="https://google.com">Test</a>';

                // Add bottom label
                var label = chart.chartContainer.createChild(am4core.Label);
                label.text = "[bold]HANDED-OVER";
                //label.html = '<a href="https://google.com">HANDED-OVER AREA</a>';
                label.fontSize = bottomLabelFontSize;
                label.align = "center";
                label.marginTop = labelMarginTop;
                label.fill = BOTTOM_LABEL_COL;

                /**
                 * Normal axis
                 */

                var axis = chart.xAxes.push(new am4charts.ValueAxis());
                axis.min = chartMin;
                axis.max = chartMax;
                axis.strictMinMax = true;
                axis.renderer.radius = am4core.percent(80);
                axis.renderer.inside = true;
                axis.renderer.line.strokeOpacity = 0.5; // line opacity inside curve line
                axis.renderer.ticks.template.disabled = false;
                axis.renderer.ticks.template.strokeOpacity = 1;
                //axis.renderer.ticks.template.strokeWidth = 1;
                axis.renderer.ticks.template.length = 10;
                axis.renderer.ticks.template.stroke = am4core.color(axis1TickColor);
                //axis.renderer.grid.template.disabled = true;
                axis.renderer.labels.template.radius = am4core.percent(40);
                axis.renderer.labels.template.fontSize = "1.2em"; // default: 1.2em inner radius axis percent labels (0 to 100%)
                axis.renderer.labels.template.fill = am4core.color(axis1TickColor);

                /**
                 * Axis for ranges
                 */

                var axis2 = chart.xAxes.push(new am4charts.ValueAxis());
                axis2.min = chartMin;
                axis2.max = chartMax;
                axis2.strictMinMax = true;
                axis2.renderer.labels.template.disabled = true;
                axis2.renderer.ticks.template.disabled = true;
                axis2.renderer.grid.template.disabled = true; // when true inside tick marks will disappear
                axis2.renderer.grid.template.opacity = 0.5;
                axis2.renderer.labels.template.bent = true;
                axis2.renderer.labels.template.fill = am4core.color("#000");
                axis2.renderer.labels.template.fontWeight = "bold";
                axis2.renderer.labels.template.fillOpacity = 0.7;

                /**
          Ranges
          */

                for (let grading of data.gradingData) {
                    var range = axis2.axisRanges.create();
                    range.axisFill.fill = am4core.color(grading.color);
                    range.axisFill.fillOpacity = 1; // default 0.8 fill-color of
                    range.axisFill.zIndex = -1;
                    range.value =
                        grading.lowScore > chartMin ? grading.lowScore : chartMin;
                    range.endValue =
                        grading.highScore < chartMax ? grading.highScore : chartMax;
                    range.grid.strokeOpacity = 0; // changes opacity of inside tick mark
                    range.stroke = am4core.color(grading.color).lighten(-0.1);
                    range.label.inside = true;
                    range.label.text = grading.title.toUpperCase();
                    range.label.inside = true;
                    range.label.location = 0.5;
                    range.label.inside = true;
                    range.label.radius = am4core.percent(10);
                    range.label.paddingBottom = -5; // ~half font size
                    range.label.fontSize = "1.4em"; // category label (i.e., N-01, N-02, ....)
                }

                var matchingGrade = lookUpGrade(data.score, data.gradingData);

                /**
                 * Label 1 (total Percent)
                 */

                var label = chart.radarContainer.createChild(am4core.Label);
                label.isMeasured = false;
                label.fontSize = totalPercentLabel_fontSize;
                label.x = am4core.percent(50);
                label.y = totalPercentLabel_y;
                label.paddingBottom = -5;
                label.horizontalCenter = "middle";
                label.verticalCenter = "bottom";
                //label.dataItem = data;
                label.text = data.score.toFixed(0).toString() + "%";
                //label.text = "{score}";
                //label.fill = am4core.color(matchingGrade.color);
                label.fill = am4core.color("#00C3FF");

                /**
                 * Label 2
                 */

                var label2 = chart.radarContainer.createChild(am4core.Label);
                label2.isMeasured = false;
                label2.fontSize = totalNumberLabel_fontSize;
                label2.horizontalCenter = "middle";
                label2.verticalCenter = "bottom";
                label2.y = totalNumberLabel_y;
                label2.text = "(" + thousands_separators(total.toFixed(0)) + ")";
                label2.fill = am4core.color("#00C3FF");

                /**
                 * Hand
                 */

                var hand = chart.hands.push(new am4charts.ClockHand());
                hand.axis = axis2;
                hand.innerRadius = am4core.percent(55);
                hand.startWidth = 8;
                hand.pin.disabled = true;
                hand.value = data.score;
                hand.fill = am4core.color("#000000"); // inner color of needle
                //hand.stroke = am4core.color("#000");
                hand.fillOpacity = 0.5;
            }

            totalLotCount().then(chartTotalLotHandedOverCount);


            //////////////// 3. Structure ////////////////
            function totalStrucCount() {
                var total_struc = {
                    onStatisticField: "StrucID",
                    outStatisticFieldName: "total_struc",
                    statisticType: "count",
                };


                var total_dismantle = {
                    onStatisticField: "CASE WHEN StatusStruc = 1 THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_dismantle",
                    statisticType: "sum",
                };

                var total_s01 = {
                    onStatisticField: "CASE WHEN CP = 'S-01' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01",
                    statisticType: "sum",
                };

                var total_s01_dismantle = {
                    onStatisticField:
                        "CASE WHEN (StatusStruc = 1 and CP = 'S-01') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01_dismantle",
                    statisticType: "sum",
                };

                var total_s02 = {
                    onStatisticField: "CASE WHEN CP = 'S-02' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02",
                    statisticType: "sum",
                };

                var total_s02_dismantle = {
                    onStatisticField:
                        "CASE WHEN (StatusStruc = 1 and CP = 'S-02') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02_dismantle",
                    statisticType: "sum",
                };

                var total_s03a = {
                    onStatisticField: "CASE WHEN CP = 'S-03a' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a",
                    statisticType: "sum",
                };

                var total_s03a_dismantle = {
                    onStatisticField:
                        "CASE WHEN (StatusStruc = 1 and CP = 'S-03a') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a_dismantle",
                    statisticType: "sum",
                };

                var total_s03b = {
                    onStatisticField: "CASE WHEN CP = 'S-03b' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b",
                    statisticType: "sum",
                };

                var total_s03b_dismantle = {
                    onStatisticField:
                        "CASE WHEN (StatusStruc = 1 and CP = 'S-03b') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b_dismantle",
                    statisticType: "sum",
                };

                var total_s03c = {
                    onStatisticField: "CASE WHEN CP = 'S-03c' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c",
                    statisticType: "sum",
                };

                var total_s03c_dismantle = {
                    onStatisticField:
                        "CASE WHEN (StatusStruc = 1 and CP = 'S-03c') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c_dismantle",
                    statisticType: "sum",
                };

                var total_s04 = {
                    onStatisticField: "CASE WHEN CP = 'S-04' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04",
                    statisticType: "sum",
                };

                var total_s04_dismantle = {
                    onStatisticField:
                        "CASE WHEN (StatusStruc = 1 and CP = 'S-04') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04_dismantle",
                    statisticType: "sum",
                };

                var total_s05 = {
                    onStatisticField: "CASE WHEN CP = 'S-05' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05",
                    statisticType: "sum",
                };

                var total_s05_dismantle = {
                    onStatisticField:
                        "CASE WHEN (StatusStruc = 1 and CP = 'S-05') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05_dismantle",
                    statisticType: "sum",
                };

                var total_s06 = {
                    onStatisticField: "CASE WHEN CP = 'S-06' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06",
                    statisticType: "sum",
                };

                var total_s06_dismantle = {
                    onStatisticField:
                        "CASE WHEN (StatusStruc = 1 and CP = 'S-06') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06_dismantle",
                    statisticType: "sum",
                };

                var total_s07 = {
                    onStatisticField: "CASE WHEN CP = 'S-07' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07",
                    statisticType: "sum",
                };

                var total_s07_dismantle = {
                    onStatisticField:
                        "CASE WHEN (StatusStruc = 1 and CP = 'S-07') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07_dismantle",
                    statisticType: "sum",
                };

                var query = structureLayer.createQuery();
                query.outStatistics = [
                    total_struc,
                    total_dismantle,
                    total_s01,
                    total_s01_dismantle,
                    total_s02,
                    total_s02_dismantle,
                    total_s03a,
                    total_s03a_dismantle,
                    total_s03b,
                    total_s03b_dismantle,
                    total_s03c,
                    total_s03c_dismantle,
                    total_s04,
                    total_s04_dismantle,
                    total_s05,
                    total_s05_dismantle,
                    total_s06,
                    total_s06_dismantle,
                    total_s07,
                    total_s07_dismantle,
                ];

                return structureLayer.queryFeatures(query).then(function (response) {
                    var stats = response.features[0].attributes;
                    const total = stats.total_struc;
                    const dismantled = stats.total_dismantle;
                    const percent = (dismantled / total) * 100;

                    const s01_total = stats.total_s01;
                    const s02_total = stats.total_s02;
                    const s03a_total = stats.total_s03a;
                    const s03b_total = stats.total_s03b;
                    const s03c_total = stats.total_s03c;
                    const s04_total = stats.total_s04;
                    const s05_total = stats.total_s05;
                    const s06_total = stats.total_s06;
                    const s07_total = stats.total_s07;

                    const s01_total_dismantle = stats.total_s01_dismantle;
                    const s02_total_dismantle = stats.total_s02_dismantle;
                    const s03a_total_dismantle = stats.total_s03a_dismantle;
                    const s03b_total_dismantle = stats.total_s03b_dismantle;
                    const s03c_total_dismantle = stats.total_s03c_dismantle;
                    const s04_total_dismantle = stats.total_s04_dismantle;
                    const s05_total_dismantle = stats.total_s05_dismantle;
                    const s06_total_dismantle = stats.total_s06_dismantle;
                    const s07_total_dismantle = stats.total_s07_dismantle;

                    const s01_percent =
                        s01_total === 0 ? 0 : (s01_total_dismantle / s01_total) * 100;
                    const s02_percent =
                        s02_total === 0 ? 0 : (s02_total_dismantle / s02_total) * 100;
                    const s03a_percent =
                        s03a_total === 0 ? 0 : (s03a_total_dismantle / s03a_total) * 100;
                    const s03b_percent =
                        s03b_total === 0 ? 0 : (s03b_total_dismantle / s03b_total) * 100;
                    const s03c_percent =
                        s03c_total === 0 ? 0 : (s03c_total_dismantle / s03c_total) * 100;
                    const s04_percent =
                        s04_total === 0 ? 0 : (s04_total_dismantle / s04_total) * 100;
                    const s05_percent =
                        s05_total === 0 ? 0 : (s05_total_dismantle / s05_total) * 100;
                    const s06_percent =
                        s06_total === 0 ? 0 : (s06_total_dismantle / s06_total) * 100;
                    const s07_percent =
                        s07_total === 0 ? 0 : (s07_total_dismantle / s07_total) * 100;

                    const s01_percent_total = (s01_total_dismantle / total) * 100;
                    const s02_percent_total = (s02_total_dismantle / total) * 100;
                    const s03a_percent_total = (s03a_total_dismantle / total) * 100;
                    const s03b_percent_total = (s03b_total_dismantle / total) * 100;
                    const s03c_percent_total = (s03c_total_dismantle / total) * 100;
                    const s04_percent_total = (s04_total_dismantle / total) * 100;
                    const s05_percent_total = (s05_total_dismantle / total) * 100;
                    const s06_percent_total = (s06_total_dismantle / total) * 100;
                    const s07_percent_total = (s07_total_dismantle / total) * 100;

                    return [
                        total,
                        percent,
                        s01_percent,
                        s02_percent,
                        s03a_percent,
                        s03b_percent,
                        s03c_percent,
                        s04_percent,
                        s05_percent,
                        s06_percent,
                        s07_percent,
                        s01_percent_total,
                        s02_percent_total,
                        s03a_percent_total,
                        s03b_percent_total,
                        s03c_percent_total,
                        s04_percent_total,
                        s05_percent_total,
                        s06_percent_total,
                        s07_percent_total,
                    ];
                });
            } // End of totalStrucCount function

            function chartTotalStrucDismantleCount([
                total,
                percent,
                s01_percent,
                s02_percent,
                s03a_percent,
                s03b_percent,
                s03c_percent,
                s04_percent,
                s05_percent,
                s06_percent,
                s07_percent,
                s01_percent_total,
                s02_percent_total,
                s03a_percent_total,
                s03b_percent_total,
                s03c_percent_total,
                s04_percent_total,
                s05_percent_total,
                s06_percent_total,
                s07_percent_total,
            ]) {
                var totalScore = percent;

                var S01 = s01_percent_total;
                var S02 = s01_percent_total + s02_percent_total;
                var S03a = s01_percent_total + s02_percent_total + s03a_percent_total;
                var S03b =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total;
                var S03c =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total;
                var S04 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total;
                var S05 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total;
                var S06 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total +
                    s06_percent_total;
                var S07 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total +
                    s06_percent_total +
                    s07_percent_total;

                var chartMin = 0;
                var chartMax = 100;


                // #ffea8c|#b3ab60|#4b595e|#6693c8|#aadbff
                // const colors = ["#ffea8c", "#b3ab60", "#4b595e", "#6693c8", "#aadbff"];

                var data = {
                    score: totalScore,
                    gradingData: [
                        {
                            title: s01_percent.toFixed(0),
                            color: color_101,
                            lowScore: 0,
                            highScore: S01,
                        },
                        {
                            title: s02_percent.toFixed(0),
                            color: color_102,
                            lowScore: S01,
                            highScore: S02,
                        },
                        {
                            title: s03a_percent.toFixed(0),
                            color: color_103a,
                            lowScore: S02,
                            highScore: S03a,
                        },
                        {
                            title: s03b_percent.toFixed(0),
                            color: color_103b,
                            lowScore: S03a,
                            highScore: S03b,
                        },
                        {
                            title: s03c_percent.toFixed(0),
                            color: color_103c,
                            lowScore: S03b,
                            highScore: S03c,
                        },
                        {
                            title: s04_percent.toFixed(0),
                            color: color_104,
                            lowScore: S03c,
                            highScore: S04,
                        },
                        {
                            title: s05_percent.toFixed(0),
                            color: color_105,
                            lowScore: S04,
                            highScore: S05,
                        },
                        {
                            title: s06_percent.toFixed(0),
                            color: color_106,
                            lowScore: S05,
                            highScore: S06,
                        },
                        {
                            title: s07_percent.toFixed(0),
                            color: color_107,
                            lowScore: S06,
                            highScore: S07,
                        },
                        {
                            title: "",
                            color: "#C5C5C5",
                            lowScore: S07,
                            highScore: 100,
                        },
                    ],
                };

                /**
          Grading Lookup
          */
                function lookUpGrade(lookupScore, grades) {
                    // Only change code below this line
                    for (var i = 0; i < grades.length; i++) {
                        if (
                            grades[i].lowScore < lookupScore &&
                            grades[i].highScore >= lookupScore
                        ) {
                            return grades[i];
                        }
                    }
                    return null;
                }

                // create chart
                var chart = am4core.create("structureChartDiv", am4charts.GaugeChart);
                chart.hiddenState.properties.opacity = 0;
                chart.fontSize = 11;
                chart.innerRadius = am4core.percent(80);
                chart.resizable = true;
                chart.responsive.enabled = true;
                chart.logo.disabled = true;
                /**
                 * Chart Title
                 */
                // Title Color
                var title = chart.titles.create();
                title.text = "EXISTING STRUCTURE";
                //title.html = '<a href="https://eijigorilla.github.io/WebApp/ArcGIS_API_for_JavaScript/envi/Operational/N2_Land_Structure2/index2.html" target="_blank">EXISTING STRUCTURE</a>';
                title.fontSize = titleFontSize;
                title.align = "center";
                title.marginBottom = -10;
                title.marginTop = 0;
                title.fill = TOP_TITLE_COL;

                // Add bottom label
                var label = chart.chartContainer.createChild(am4core.Label);
                label.text = "[bold]DISMANTLED";
                label.fontSize = bottomLabelFontSize;
                label.align = "center";
                label.marginTop = labelMarginTop;
                label.fill = BOTTOM_LABEL_COL;

                /**
                 * Normal axis
                 */

                var axis = chart.xAxes.push(new am4charts.ValueAxis());
                axis.min = chartMin;
                axis.max = chartMax;
                axis.strictMinMax = true;
                axis.renderer.radius = am4core.percent(80);
                axis.renderer.inside = true;
                axis.renderer.line.strokeOpacity = 0.5; // line opacity inside curve line
                axis.renderer.ticks.template.disabled = false;
                axis.renderer.ticks.template.strokeOpacity = 1;
                //axis.renderer.ticks.template.strokeWidth = 1;
                axis.renderer.ticks.template.length = 10;
                axis.renderer.ticks.template.stroke = am4core.color(axis1TickColor);
                //axis.renderer.grid.template.disabled = true;
                axis.renderer.labels.template.radius = am4core.percent(40);
                axis.renderer.labels.template.fontSize = "1.2em"; // default: 1.2em inner radius axis percent labels (0 to 100%)
                axis.renderer.labels.template.fill = am4core.color(axis1TickColor);

                /**
                 * Axis for ranges
                 */

                var axis2 = chart.xAxes.push(new am4charts.ValueAxis());
                axis2.min = chartMin;
                axis2.max = chartMax;
                axis2.strictMinMax = true;
                axis2.renderer.labels.template.disabled = true;
                axis2.renderer.ticks.template.disabled = true;
                axis2.renderer.grid.template.disabled = true; // when true inside tick marks will disappear
                axis2.renderer.grid.template.opacity = 0.5;
                axis2.renderer.labels.template.bent = true;
                axis2.renderer.labels.template.fill = am4core.color("#000");
                axis2.renderer.labels.template.fontWeight = "bold";
                axis2.renderer.labels.template.fillOpacity = 0.7; // 0.3 // category labels: N-01, N-02,....

                /**
          Ranges
          */

                for (let grading of data.gradingData) {
                    var range = axis2.axisRanges.create();
                    range.axisFill.fill = am4core.color(grading.color);
                    range.axisFill.fillOpacity = 1;
                    range.axisFill.zIndex = -1;
                    range.value =
                        grading.lowScore > chartMin ? grading.lowScore : chartMin;
                    range.endValue =
                        grading.highScore < chartMax ? grading.highScore : chartMax;
                    range.grid.strokeOpacity = 0; // changes opacity of inside tick mark
                    range.stroke = am4core.color(grading.color).lighten(-0.1);
                    range.label.inside = true;
                    range.label.text = grading.title.toUpperCase();
                    range.label.inside = true;
                    range.label.location = 0.5;
                    range.label.inside = true;
                    range.label.radius = am4core.percent(10);
                    range.label.paddingBottom = -5; // ~half font size
                    range.label.fontSize = "1.4em"; // category label (i.e., N-01, N-02, ....)
                }

                var matchingGrade = lookUpGrade(data.score, data.gradingData);

                /**
                 * Label 1 (total Percent)
                 */

                var label = chart.radarContainer.createChild(am4core.Label);
                label.isMeasured = false;
                label.fontSize = totalPercentLabel_fontSize;
                label.x = am4core.percent(50);
                label.y = totalPercentLabel_y;
                label.paddingBottom = -5;
                label.horizontalCenter = "middle";
                label.verticalCenter = "bottom";
                //label.dataItem = data;
                label.text = data.score.toFixed(0).toString() + "%";
                //label.text = "{score}";
                //label.fill = am4core.color(matchingGrade.color);
                label.fill = am4core.color("#00C3FF");

                /**
                 * Label 2
                 */

                var label2 = chart.radarContainer.createChild(am4core.Label);
                label2.isMeasured = false;
                label2.fontSize = totalNumberLabel_fontSize;
                label2.horizontalCenter = "middle";
                label2.verticalCenter = "bottom";
                label2.y = totalNumberLabel_y;
                label2.text = "(" + thousands_separators(total) + ")";
                label2.fill = am4core.color("#00C3FF");

                /**
                 * Hand
                 */

                var hand = chart.hands.push(new am4charts.ClockHand());
                hand.axis = axis2;
                hand.innerRadius = am4core.percent(55);
                hand.startWidth = 8;
                hand.pin.disabled = true;
                hand.value = data.score;
                hand.fill = am4core.color("#000000"); // inner color of needle
                //hand.stroke = am4core.color("#000");
                hand.fillOpacity = 0.5;
            }
            totalStrucCount().then(chartTotalStrucDismantleCount);



            //////////////// 4. ISF ////////////////
            function totalIsfCount() {
                var total_isf = {
                    onStatisticField: "StrucID",
                    outStatisticFieldName: "total_isf",
                    statisticType: "count",
                };

                var total_isf_relocated = {
                    onStatisticField: "CASE WHEN StatusRC = 1 THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_isf_relocated",
                    statisticType: "sum",
                };

                var total_s01 = {
                    onStatisticField: "CASE WHEN CP = 'S-01' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01",
                    statisticType: "sum",
                };

                var total_s01_isf = {
                    onStatisticField:
                        "CASE WHEN (StatusRC = 1 and CP = 'S-01') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01_isf",
                    statisticType: "sum",
                };

                var total_s02 = {
                    onStatisticField: "CASE WHEN CP = 'S-02' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02",
                    statisticType: "sum",
                };

                var total_s02_isf = {
                    onStatisticField:
                        "CASE WHEN (StatusRC = 1 and CP = 'S-02') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02_isf",
                    statisticType: "sum",
                };

                var total_s03a = {
                    onStatisticField: "CASE WHEN CP = 'S-03a' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a",
                    statisticType: "sum",
                };

                var total_s03a_isf = {
                    onStatisticField:
                        "CASE WHEN (StatusRC = 1 and CP = 'S-03a') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a_isf",
                    statisticType: "sum",
                };

                var total_s03b = {
                    onStatisticField: "CASE WHEN CP = 'S-03b' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b",
                    statisticType: "sum",
                };

                var total_s03b_isf = {
                    onStatisticField:
                        "CASE WHEN (StatusRC = 1 and CP = 'S-03b') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b_isf",
                    statisticType: "sum",
                };

                var total_s03c = {
                    onStatisticField: "CASE WHEN CP = 'S-03c' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c",
                    statisticType: "sum",
                };

                var total_s03c_isf = {
                    onStatisticField:
                        "CASE WHEN (StatusRC = 1 and CP = 'S-03c') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c_isf",
                    statisticType: "sum",
                };

                var total_s04 = {
                    onStatisticField: "CASE WHEN CP = 'S-04' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04",
                    statisticType: "sum",
                };

                var total_s04_isf = {
                    onStatisticField:
                        "CASE WHEN (StatusRC = 1 and CP = 'S-04') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04_isf",
                    statisticType: "sum",
                };

                var total_s05 = {
                    onStatisticField: "CASE WHEN CP = 'S-05' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05",
                    statisticType: "sum",
                };

                var total_s05_isf = {
                    onStatisticField:
                        "CASE WHEN (StatusRC = 1 and CP = 'S-05') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05_isf",
                    statisticType: "sum",
                };

                var total_s06 = {
                    onStatisticField: "CASE WHEN CP = 'S-06' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06",
                    statisticType: "sum",
                };

                var total_s06_isf = {
                    onStatisticField:
                        "CASE WHEN (StatusRC = 1 and CP = 'S-06') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06_isf",
                    statisticType: "sum",
                };

                var total_s07 = {
                    onStatisticField: "CASE WHEN CP = 'S-07' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07",
                    statisticType: "sum",
                };

                var total_s07_isf = {
                    onStatisticField:
                        "CASE WHEN (StatusRC = 1 and CP = 'S-07') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07_isf",
                    statisticType: "sum",
                };

                var query = reloISFLayer.createQuery();
                query.outStatistics = [
                    total_isf,
                    total_isf_relocated,
                    total_s01,
                    total_s01_isf,
                    total_s02,
                    total_s02_isf,
                    total_s03a,
                    total_s03a_isf,
                    total_s03b,
                    total_s03b_isf,
                    total_s03c,
                    total_s03c_isf,
                    total_s04,
                    total_s04_isf,
                    total_s05,
                    total_s05_isf,
                    total_s06,
                    total_s06_isf,
                    total_s07,
                    total_s07_isf,
                ];

                return reloISFLayer.queryFeatures(query).then(function (response) {
                    var stats = response.features[0].attributes;
                    const total = stats.total_isf;
                    const isfd = stats.total_isf_relocated;
                    const percent = (isfd / total) * 100;

                    const s01_total = stats.total_s01;
                    const s02_total = stats.total_s02;
                    const s03a_total = stats.total_s03a;
                    const s03b_total = stats.total_s03b;
                    const s03c_total = stats.total_s03c;
                    const s04_total = stats.total_s04;
                    const s05_total = stats.total_s05;
                    const s06_total = stats.total_s06;
                    const s07_total = stats.total_s07;

                    const s01_total_isf = stats.total_s01_isf;
                    const s02_total_isf = stats.total_s02_isf;
                    const s03a_total_isf = stats.total_s03a_isf;
                    const s03b_total_isf = stats.total_s03b_isf;
                    const s03c_total_isf = stats.total_s03c_isf;
                    const s04_total_isf = stats.total_s04_isf;
                    const s05_total_isf = stats.total_s05_isf;
                    const s06_total_isf = stats.total_s06_isf;
                    const s07_total_isf = stats.total_s07_isf;

                    const s01_percent =
                        s01_total === 0 ? 0 : (s01_total_isf / s01_total) * 100;
                    const s02_percent =
                        s02_total === 0 ? 0 : (s02_total_isf / s02_total) * 100;
                    const s03a_percent =
                        s03a_total === 0 ? 0 : (s03a_total_isf / s03a_total) * 100;
                    const s03b_percent =
                        s03b_total === 0 ? 0 : (s03b_total_isf / s03b_total) * 100;
                    const s03c_percent =
                        s03c_total === 0 ? 0 : (s03c_total_isf / s03c_total) * 100;
                    const s04_percent =
                        s04_total === 0 ? 0 : (s04_total_isf / s04_total) * 100;
                    const s05_percent =
                        s05_total === 0 ? 0 : (s05_total_isf / s05_total) * 100;
                    const s06_percent =
                        s06_total === 0 ? 0 : (s06_total_isf / s06_total) * 100;
                    const s07_percent =
                        s07_total === 0 ? 0 : (s07_total_isf / s07_total) * 100;

                    const s01_percent_total = (s01_total_isf / total) * 100;
                    const s02_percent_total = (s02_total_isf / total) * 100;
                    const s03a_percent_total = (s03a_total_isf / total) * 100;
                    const s03b_percent_total = (s03b_total_isf / total) * 100;
                    const s03c_percent_total = (s03c_total_isf / total) * 100;
                    const s04_percent_total = (s04_total_isf / total) * 100;
                    const s05_percent_total = (s05_total_isf / total) * 100;
                    const s06_percent_total = (s06_total_isf / total) * 100;
                    const s07_percent_total = (s07_total_isf / total) * 100;

                    return [
                        total,
                        percent,
                        s01_percent,
                        s02_percent,
                        s03a_percent,
                        s03b_percent,
                        s03c_percent,
                        s04_percent,
                        s05_percent,
                        s06_percent,
                        s07_percent,
                        s01_percent_total,
                        s02_percent_total,
                        s03a_percent_total,
                        s03b_percent_total,
                        s03c_percent_total,
                        s04_percent_total,
                        s05_percent_total,
                        s06_percent_total,
                        s07_percent_total,
                    ];
                });
            }


            function chartTotalIsfRelocateCount([
                total,
                percent,
                s01_percent,
                s02_percent,
                s03a_percent,
                s03b_percent,
                s03c_percent,
                s04_percent,
                s05_percent,
                s06_percent,
                s07_percent,
                s01_percent_total,
                s02_percent_total,
                s03a_percent_total,
                s03b_percent_total,
                s03c_percent_total,
                s04_percent_total,
                s05_percent_total,
                s06_percent_total,
                s07_percent_total,
            ]) {
                var totalScore = percent;

                var S01 = s01_percent_total;
                var S02 = s01_percent_total + s02_percent_total;
                var S03a = s01_percent_total + s02_percent_total + s03a_percent_total;
                var S03b =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total;
                var S03c =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total;
                var S04 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total;
                var S05 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total;
                var S06 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total +
                    s06_percent_total;
                var S07 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total +
                    s06_percent_total +
                    s07_percent_total;

                var chartMin = 0;
                var chartMax = 100;

                // #ffea8c|#b3ab60|#4b595e|#6693c8|#aadbff
                // const colors = ["#ffea8c", "#b3ab60", "#4b595e", "#6693c8", "#aadbff"];

                var data = {
                    score: totalScore,
                    gradingData: [
                        {
                            title: s01_percent.toFixed(0),
                            color: color_101,
                            lowScore: 0,
                            highScore: S01,
                        },
                        {
                            title: s02_percent.toFixed(0),
                            color: color_102,
                            lowScore: S01,
                            highScore: S02,
                        },
                        {
                            title: s03a_percent.toFixed(0),
                            color: color_103a,
                            lowScore: S02,
                            highScore: S03a,
                        },
                        {
                            title: s03b_percent.toFixed(0),
                            color: color_103b,
                            lowScore: S03a,
                            highScore: S03b,
                        },
                        {
                            title: s03c_percent.toFixed(0),
                            color: color_103c,
                            lowScore: S03b,
                            highScore: S03c,
                        },
                        {
                            title: s04_percent.toFixed(0),
                            color: color_104,
                            lowScore: S03c,
                            highScore: S04,
                        },
                        {
                            title: s05_percent.toFixed(0),
                            color: color_105,
                            lowScore: S04,
                            highScore: S05,
                        },
                        {
                            title: s06_percent.toFixed(0),
                            color: color_106,
                            lowScore: S05,
                            highScore: S06,
                        },
                        {
                            title: s07_percent.toFixed(0),
                            color: color_107,
                            lowScore: S06,
                            highScore: S07,
                        },
                        {
                            title: "",
                            color: "#C5C5C5",
                            lowScore: S07,
                            highScore: 100,
                        },
                    ],
                };



                /**
          Grading Lookup
          */
                function lookUpGrade(lookupScore, grades) {
                    // Only change code below this line
                    for (var i = 0; i < grades.length; i++) {
                        if (
                            grades[i].lowScore < lookupScore &&
                            grades[i].highScore >= lookupScore
                        ) {
                            return grades[i];
                        }
                    }
                    return null;
                }

                // create chart
                var chart = am4core.create("isfChartDiv", am4charts.GaugeChart);
                chart.hiddenState.properties.opacity = 0;
                chart.fontSize = 11;
                chart.innerRadius = am4core.percent(80);
                chart.resizable = true;
                chart.responsive.enabled = true;
                chart.logo.disabled = true;
                /**
                 * Chart Title
                 */
                // Title Color
                var title = chart.titles.create();
                title.text = "INFORMAL SETTLERS";
                //title.html = '<a href="https://eijigorilla.github.io/WebApp/ArcGIS_API_for_JavaScript/envi/Operational/N2_Land_Structure2/index2.html" target="_blank">INFORMAL SETTLERS</a>';
                title.fontSize = titleFontSize;
                title.align = "center";
                title.marginBottom = -10;
                title.marginTop = 0;
                title.fill = TOP_TITLE_COL;

                // Add bottom label
                var label = chart.chartContainer.createChild(am4core.Label);
                label.text = "[bold]RELOCATED";
                label.fontSize = bottomLabelFontSize;
                label.align = "center";
                label.marginTop = labelMarginTop;
                label.fill = BOTTOM_LABEL_COL;

                /**
                 * Normal axis
                 */

                var axis = chart.xAxes.push(new am4charts.ValueAxis());
                axis.min = chartMin;
                axis.max = chartMax;
                axis.strictMinMax = true;
                axis.renderer.radius = am4core.percent(80);
                axis.renderer.inside = true;
                axis.renderer.line.strokeOpacity = 0.5; // line opacity inside curve line
                axis.renderer.ticks.template.disabled = false;
                axis.renderer.ticks.template.strokeOpacity = 1;
                //axis.renderer.ticks.template.strokeWidth = 1;
                axis.renderer.ticks.template.length = 10;
                axis.renderer.ticks.template.stroke = am4core.color(axis1TickColor);
                //axis.renderer.grid.template.disabled = true;
                axis.renderer.labels.template.radius = am4core.percent(40);
                axis.renderer.labels.template.fontSize = "1.2em"; // default: 1.2em inner radius axis percent labels (0 to 100%)
                axis.renderer.labels.template.fill = am4core.color(axis1TickColor);

                /**
                 * Axis for ranges
                 */

                var axis2 = chart.xAxes.push(new am4charts.ValueAxis());
                axis2.min = chartMin;
                axis2.max = chartMax;
                axis2.strictMinMax = true;
                axis2.renderer.labels.template.disabled = true;
                axis2.renderer.ticks.template.disabled = true;
                axis2.renderer.grid.template.disabled = true; // when true inside tick marks will disappear
                axis2.renderer.grid.template.opacity = 0.5;
                axis2.renderer.labels.template.bent = true;
                axis2.renderer.labels.template.fill = am4core.color("#000");
                axis2.renderer.labels.template.fontWeight = "bold";
                axis2.renderer.labels.template.fillOpacity = 0.7;

                /**
          Ranges
          */

                for (let grading of data.gradingData) {
                    var range = axis2.axisRanges.create();
                    range.axisFill.fill = am4core.color(grading.color);
                    range.axisFill.fillOpacity = 1;
                    range.axisFill.zIndex = -1;
                    range.value =
                        grading.lowScore > chartMin ? grading.lowScore : chartMin;
                    range.endValue =
                        grading.highScore < chartMax ? grading.highScore : chartMax;
                    range.grid.strokeOpacity = 0; // changes opacity of inside tick mark
                    range.stroke = am4core.color(grading.color).lighten(-0.1);
                    range.label.inside = true;
                    range.label.text = grading.title.toUpperCase();
                    range.label.inside = true;
                    range.label.location = 0.5;
                    range.label.inside = true;
                    range.label.radius = am4core.percent(10);
                    range.label.paddingBottom = -5; // ~half font size
                    range.label.fontSize = "1.4em"; // category label (i.e., N-01, N-02, ....)
                }

                var matchingGrade = lookUpGrade(data.score, data.gradingData);

                /**
                 * Label 1 (total Percent)
                 */

                var label = chart.radarContainer.createChild(am4core.Label);
                label.isMeasured = false;
                label.fontSize = totalPercentLabel_fontSize;
                label.x = am4core.percent(50);
                label.y = totalPercentLabel_y;
                label.paddingBottom = -5;
                label.horizontalCenter = "middle";
                label.verticalCenter = "bottom";

                //label.dataItem = data;
                label.wrap = true;
                label.text = data.score.toFixed(0).toString() + "%";
                //label.text = "{score}";
                //label.fill = am4core.color(matchingGrade.color);
                label.fill = am4core.color("#00C3FF");

                /**
                 * Label 2
                 */

                var label2 = chart.radarContainer.createChild(am4core.Label);
                label2.isMeasured = false;
                label2.fontSize = totalNumberLabel_fontSize;
                label2.horizontalCenter = "middle";
                label2.verticalCenter = "bottom";
                label2.y = totalNumberLabel_y;
                label2.text = "(" + thousands_separators(total) + ")";
                label2.fill = am4core.color("#00C3FF");

                /**
                 * Hand
                 */

                var hand = chart.hands.push(new am4charts.ClockHand());
                hand.axis = axis2;
                hand.innerRadius = am4core.percent(55);
                hand.startWidth = 8;
                hand.pin.disabled = true;
                hand.value = data.score;
                hand.fill = am4core.color("#000000"); // inner color of needle
                //hand.stroke = am4core.color("#000");
                hand.fillOpacity = 0.5;
            }
            totalIsfCount().then(chartTotalIsfRelocateCount);



            //////////////// Tree ////////////////

            //////////////// 5. Tree Cutting ////////////////

            function totalTreeCuttingCount() {
                var total_tree = {
                    onStatisticField: "TreeNo",
                    outStatisticFieldName: "total_tree",
                    statisticType: "count",
                };

                var total_cut = {
                    onStatisticField: "CASE WHEN Status = 1 THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_cut",
                    statisticType: "sum",
                };

                var total_s01 = {
                    onStatisticField: "CASE WHEN CP = 'S-01' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01",
                    statisticType: "sum",
                };

                var total_s01_cut = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-01') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01_cut",
                    statisticType: "sum",
                };

                var total_s02 = {
                    onStatisticField: "CASE WHEN CP = 'S-02' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02",
                    statisticType: "sum",
                };

                var total_s02_cut = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-02') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02_cut",
                    statisticType: "sum",
                };

                var total_s03a = {
                    onStatisticField: "CASE WHEN CP = 'S-03a' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a",
                    statisticType: "sum",
                };

                var total_s03a_cut = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-03a') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a_cut",
                    statisticType: "sum",
                };

                var total_s03b = {
                    onStatisticField: "CASE WHEN CP = 'S-03b' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b",
                    statisticType: "sum",
                };

                var total_s03b_cut = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-03b') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b_cut",
                    statisticType: "sum",
                };

                var total_s03c = {
                    onStatisticField: "CASE WHEN CP = 'S-03c' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c",
                    statisticType: "sum",
                };

                var total_s03c_cut = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-03c') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c_cut",
                    statisticType: "sum",
                };

                var total_s04 = {
                    onStatisticField: "CASE WHEN CP = 'S-04' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04",
                    statisticType: "sum",
                };

                var total_s04_cut = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-04') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04_cut",
                    statisticType: "sum",
                };

                var total_s05 = {
                    onStatisticField: "CASE WHEN CP = 'S-05' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05",
                    statisticType: "sum",
                };

                var total_s05_cut = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-05') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05_cut",
                    statisticType: "sum",
                };

                var total_s06 = {
                    onStatisticField: "CASE WHEN CP = 'S-06' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06",
                    statisticType: "sum",
                };

                var total_s06_cut = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-06') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06_cut",
                    statisticType: "sum",
                };

                var total_s07 = {
                    onStatisticField: "CASE WHEN CP = 'S-07' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07",
                    statisticType: "sum",
                };

                var total_s07_cut = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-07') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07_cut",
                    statisticType: "sum",
                };

                var query = treeLayer.createQuery();
                query.outStatistics = [
                    total_tree,
                    total_cut,
                    total_s01,
                    total_s01_cut,
                    total_s02,
                    total_s02_cut,
                    total_s03a,
                    total_s03a_cut,
                    total_s03b,
                    total_s03b_cut,
                    total_s03c,
                    total_s03c_cut,
                    total_s04,
                    total_s04_cut,
                    total_s05,
                    total_s05_cut,
                    total_s06,
                    total_s06_cut,
                    total_s07,
                    total_s07_cut,
                ];

                return treeLayer.queryFeatures(query).then(function (response) {
                    var stats = response.features[0].attributes;
                    const total = stats.total_tree;
                    //console.log(total);
                
                    const cutd = stats.total_cut;
                    const percent = (cutd / total) * 100;

                    const s01_total = stats.total_s01;
                    const s02_total = stats.total_s02;
                    const s03a_total = stats.total_s03a;
                    const s03b_total = stats.total_s03b;
                    const s03c_total = stats.total_s03c;
                    const s04_total = stats.total_s04;
                    const s05_total = stats.total_s05;
                    const s06_total = stats.total_s06;
                    const s07_total = stats.total_s07;

                    const s01_total_cut = stats.total_s01_cut;
                    const s02_total_cut = stats.total_s02_cut;
                    const s03a_total_cut = stats.total_s03a_cut;
                    const s03b_total_cut = stats.total_s03b_cut;
                    const s03c_total_cut = stats.total_s03c_cut;
                    const s04_total_cut = stats.total_s04_cut;
                    const s05_total_cut = stats.total_s05_cut;
                    const s06_total_cut = stats.total_s06_cut;
                    const s07_total_cut = stats.total_s07_cut;

                    const s01_percent =
                        s01_total === 0 ? 0 : (s01_total_cut / s01_total) * 100;
                    const s02_percent =
                        s02_total === 0 ? 0 : (s02_total_cut / s02_total) * 100;
                    const s03a_percent =
                        s03a_total === 0 ? 0 : (s03a_total_cut / s03a_total) * 100;
                    const s03b_percent =
                        s03b_total === 0 ? 0 : (s03b_total_cut / s03b_total) * 100;
                    const s03c_percent =
                        s03c_total === 0 ? 0 : (s03c_total_cut / s03c_total) * 100;
                    const s04_percent =
                        s04_total === 0 ? 0 : (s04_total_cut / s04_total) * 100;
                    const s05_percent =
                        s05_total === 0 ? 0 : (s05_total_cut / s05_total) * 100;
                    const s06_percent =
                        s06_total === 0 ? 0 : (s06_total_cut / s06_total) * 100;
                    const s07_percent =
                        s07_total === 0 ? 0 : (s07_total_cut / s07_total) * 100;

                    const s01_percent_total = (s01_total_cut / total) * 100;
                    const s02_percent_total = (s02_total_cut / total) * 100;
                    const s03a_percent_total = (s03a_total_cut / total) * 100;
                    const s03b_percent_total = (s03b_total_cut / total) * 100;
                    const s03c_percent_total = (s03c_total_cut / total) * 100;
                    const s04_percent_total = (s04_total_cut / total) * 100;
                    const s05_percent_total = (s05_total_cut / total) * 100;
                    const s06_percent_total = (s06_total_cut / total) * 100;
                    const s07_percent_total = (s07_total_cut / total) * 100;

                    return [
                        total,
                        percent,
                        s01_percent,
                        s02_percent,
                        s03a_percent,
                        s03b_percent,
                        s03c_percent,
                        s04_percent,
                        s05_percent,
                        s06_percent,
                        s07_percent,
                        s01_percent_total,
                        s02_percent_total,
                        s03a_percent_total,
                        s03b_percent_total,
                        s03c_percent_total,
                        s04_percent_total,
                        s05_percent_total,
                        s06_percent_total,
                        s07_percent_total,
                    ];
                    

                });
            } // End of treeCutSummary function

            
            function chartTotalTreeCutCount([
                total,
                percent,
                s01_percent,
                s02_percent,
                s03a_percent,
                s03b_percent,
                s03c_percent,
                s04_percent,
                s05_percent,
                s06_percent,
                s07_percent,
                s01_percent_total,
                s02_percent_total,
                s03a_percent_total,
                s03b_percent_total,
                s03c_percent_total,
                s04_percent_total,
                s05_percent_total,
                s06_percent_total,
                s07_percent_total,
            ]) {
                var totalScore = percent;

                var S01 = s01_percent_total;
                var S02 = s01_percent_total + s02_percent_total;
                var S03a = s01_percent_total + s02_percent_total + s03a_percent_total;
                var S03b =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total;
                var S03c =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total;
                var S04 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total;
                var S05 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total;
                var S06 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total +
                    s06_percent_total;
                var S07 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total +
                    s06_percent_total +
                    s07_percent_total;

                var chartMin = 0;
                var chartMax = 100;

                // #ffea8c|#b3ab60|#4b595e|#6693c8|#aadbff
                // const colors = ["#ffea8c", "#b3ab60", "#4b595e", "#6693c8", "#aadbff"];

                var data = {
                    score: totalScore,
                    gradingData: [
                        {
                            title: s01_percent.toFixed(0),
                            color: color_101,
                            lowScore: 0,
                            highScore: S01,
                        },
                        {
                            title: s02_percent.toFixed(0),
                            color: color_102,
                            lowScore: S01,
                            highScore: S02,
                        },
                        {
                            title: s03a_percent.toFixed(0),
                            color: color_103a,
                            lowScore: S02,
                            highScore: S03a,
                        },
                        {
                            title: s03b_percent.toFixed(0),
                            color: color_103b,
                            lowScore: S03a,
                            highScore: S03b,
                        },
                        {
                            title: s03c_percent.toFixed(0),
                            color: color_103c,
                            lowScore: S03b,
                            highScore: S03c,
                        },
                        {
                            title: s04_percent.toFixed(0),
                            color: color_104,
                            lowScore: S03c,
                            highScore: S04,
                        },
                        {
                            title: s05_percent.toFixed(0),
                            color: color_105,
                            lowScore: S04,
                            highScore: S05,
                        },
                        {
                            title: s06_percent.toFixed(0),
                            color: color_106,
                            lowScore: S05,
                            highScore: S06,
                        },
                        {
                            title: s07_percent.toFixed(0),
                            color: color_107,
                            lowScore: S06,
                            highScore: S07,
                        },
                        {
                            title: "",
                            color: "#C5C5C5",
                            lowScore: S07,
                            highScore: 100,
                        },
                    ],
                };

                /**
          Grading Lookup
          */

                function lookUpGrade(lookupScore, grades) {
                    // Only change code below this line
                    for (var i = 0; i < grades.length; i++) {
                        if (
                            grades[i].lowScore < lookupScore &&
                            grades[i].highScore >= lookupScore
                        ) {
                            return grades[i];
                        }
                    }
                    return null;
                }

                // create chart
                var chart = am4core.create(
                    "treeCuttingChartDiv",
                    am4charts.GaugeChart
                );
                chart.hiddenState.properties.opacity = 0;
                chart.fontSize = 11;
                chart.innerRadius = am4core.percent(80);
                chart.resizable = true;
                chart.responsive.enabled = true;
                chart.logo.disabled = true;
                /**
                 * Chart Title
                 */
                // Title Color
                var title = chart.titles.create();
                title.text = "TREE CUTTING";
                //title.html = '<a href="https://eijigorilla.github.io/WebApp/ArcGIS_API_for_JavaScript/envi/Operational/N2_Land_Structure2/index2.html" target="_blank">INFORMAL SETTLERS</a>';
                title.fontSize = titleFontSize;
                title.align = "center";
                title.marginBottom = -10;
                title.marginTop = 0;
                title.fill = TOP_TITLE_COL;

                // Add bottom label
                var label = chart.chartContainer.createChild(am4core.Label);
                label.text = "[bold]CUT/EARTHBALLED";
                label.fontSize = bottomLabelFontSize;
                label.align = "center";
                label.marginTop = labelMarginTop;
                label.fill = BOTTOM_LABEL_COL;

                /**
                 * Normal axis
                 */

                var axis = chart.xAxes.push(new am4charts.ValueAxis());
                axis.min = chartMin;
                axis.max = chartMax;
                axis.strictMinMax = true;
                axis.renderer.radius = am4core.percent(80);
                axis.renderer.inside = true;
                axis.renderer.line.strokeOpacity = 0.5; // line opacity inside curve line
                axis.renderer.ticks.template.disabled = false;
                axis.renderer.ticks.template.strokeOpacity = 1;
                //axis.renderer.ticks.template.strokeWidth = 1;
                axis.renderer.ticks.template.length = 10;
                axis.renderer.ticks.template.stroke = am4core.color(axis1TickColor);
                //axis.renderer.grid.template.disabled = true;
                axis.renderer.labels.template.radius = am4core.percent(40);
                axis.renderer.labels.template.fontSize = "1.2em"; // default: 1.2em inner radius axis percent labels (0 to 100%)
                axis.renderer.labels.template.fill = am4core.color(axis1TickColor);

                /**
                 * Axis for ranges
                 */

                var axis2 = chart.xAxes.push(new am4charts.ValueAxis());
                axis2.min = chartMin;
                axis2.max = chartMax;
                axis2.strictMinMax = true;
                axis2.renderer.labels.template.disabled = true;
                axis2.renderer.ticks.template.disabled = true;
                axis2.renderer.grid.template.disabled = true; // when true inside tick marks will disappear
                axis2.renderer.grid.template.opacity = 0.5;
                axis2.renderer.labels.template.bent = true;
                axis2.renderer.labels.template.fill = am4core.color("#000");
                axis2.renderer.labels.template.fontWeight = "bold";
                axis2.renderer.labels.template.fillOpacity = 0.7;

                /**
          Ranges
          */

                for (let grading of data.gradingData) {
                    var range = axis2.axisRanges.create();
                    range.axisFill.fill = am4core.color(grading.color);
                    range.axisFill.fillOpacity = 1;
                    range.axisFill.zIndex = -1;
                    range.value =
                        grading.lowScore > chartMin ? grading.lowScore : chartMin;
                    range.endValue =
                        grading.highScore < chartMax ? grading.highScore : chartMax;
                    range.grid.strokeOpacity = 0; // changes opacity of inside tick mark
                    range.stroke = am4core.color(grading.color).lighten(-0.1);
                    range.label.inside = true;
                    range.label.text = grading.title.toUpperCase();
                    range.label.inside = true;
                    range.label.location = 0.5;
                    range.label.inside = true;
                    range.label.radius = am4core.percent(10);
                    range.label.paddingBottom = -5; // ~half font size
                    range.label.fontSize = "1.4em"; // category label (i.e., N-01, N-02, ....)
                }

                var matchingGrade = lookUpGrade(data.score, data.gradingData);

                /**
                 * Label 1 (total Percent)
                 */

                var label = chart.radarContainer.createChild(am4core.Label);
                label.isMeasured = false;
                label.fontSize = totalPercentLabel_fontSize;
                label.x = am4core.percent(50);
                label.y = totalPercentLabel_y;
                label.paddingBottom = -5;
                label.horizontalCenter = "middle";
                label.verticalCenter = "bottom";

                //label.dataItem = data;
                label.wrap = true;
                label.text = data.score.toFixed(0).toString() + "%";
                //label.text = "{score}";
                //label.fill = am4core.color(matchingGrade.color);
                label.fill = am4core.color("#00C3FF");

                /**
                 * Label 2
                 */

                var label2 = chart.radarContainer.createChild(am4core.Label);
                label2.isMeasured = false;
                label2.fontSize = totalNumberLabel_fontSize;
                label2.horizontalCenter = "middle";
                label2.verticalCenter = "bottom";
                label2.y = totalNumberLabel_y;
                label2.text = "(" + thousands_separators(total) + ")";
                label2.fill = am4core.color("#00C3FF");

                /**
                 * Hand
                 */

                var hand = chart.hands.push(new am4charts.ClockHand());
                hand.axis = axis2;
                hand.innerRadius = am4core.percent(55);
                hand.startWidth = 8;
                hand.pin.disabled = true;
                hand.value = data.score;
                hand.fill = am4core.color("#000000"); // inner color of needle
                //hand.stroke = am4core.color("#000");
                hand.fillOpacity = 0.5;
            }

            totalTreeCuttingCount().then(chartTotalTreeCutCount);



            ////////////// 6. Tree Compensation ////////////

            function totalTreeCompensationCount() {
                var total_tree = {
                    onStatisticField: "CASE WHEN Compensation >= 2 THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_tree",
                    statisticType: "sum",
                };

                var total_compensation = {
                    onStatisticField: "CASE WHEN Compensation = 3 THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_compensation",
                    statisticType: "sum",
                };

                var total_s01 = {
                    onStatisticField: "CASE WHEN CP = 'S-01' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01",
                    statisticType: "sum",
                };

                var total_s01_compensation = {
                    onStatisticField:
                        "CASE WHEN (Compensation = 3 and CP = 'S-01') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01_compensation",
                    statisticType: "sum",
                };

                var total_s02 = {
                    onStatisticField: "CASE WHEN CP = 'S-02' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02",
                    statisticType: "sum",
                };

                var total_s02_compensation = {
                    onStatisticField:
                        "CASE WHEN (Compensation = 3 and CP = 'S-02') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02_compensation",
                    statisticType: "sum",
                };

                var total_s03a = {
                    onStatisticField: "CASE WHEN CP = 'S-03a' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a",
                    statisticType: "sum",
                };

                var total_s03a_compensation = {
                    onStatisticField:
                        "CASE WHEN (Compensation = 3 and CP = 'S-03a') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a_compensation",
                    statisticType: "sum",
                };

                var total_s03b = {
                    onStatisticField: "CASE WHEN CP = 'S-03b' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b",
                    statisticType: "sum",
                };

                var total_s03b_compensation = {
                    onStatisticField:
                        "CASE WHEN (Compensation = 3 and CP = 'S-03b') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b_compensation",
                    statisticType: "sum",
                };

                var total_s03c = {
                    onStatisticField: "CASE WHEN CP = 'S-03c' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c",
                    statisticType: "sum",
                };

                var total_s03c_compensation = {
                    onStatisticField:
                        "CASE WHEN (Compensation = 3 and CP = 'S-03c') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c_compensation",
                    statisticType: "sum",
                };

                var total_s04 = {
                    onStatisticField: "CASE WHEN CP = 'S-04' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04",
                    statisticType: "sum",
                };

                var total_s04_compensation = {
                    onStatisticField:
                        "CASE WHEN (Compensation = 3 and CP = 'S-04') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04_compensation",
                    statisticType: "sum",
                };

                var total_s05 = {
                    onStatisticField: "CASE WHEN CP = 'S-05' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05",
                    statisticType: "sum",
                };

                var total_s05_compensation = {
                    onStatisticField:
                        "CASE WHEN (Compensation = 3 and CP = 'S-05') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05_compensation",
                    statisticType: "sum",
                };

                var total_s06 = {
                    onStatisticField: "CASE WHEN CP = 'S-06' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06",
                    statisticType: "sum",
                };

                var total_s06_compensation = {
                    onStatisticField:
                        "CASE WHEN (Compensation = 3 and CP = 'S-06') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06_compensation",
                    statisticType: "sum",
                };

                var total_s07 = {
                    onStatisticField: "CASE WHEN CP = 'S-07' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07",
                    statisticType: "sum",
                };

                var total_s07_compensation = {
                    onStatisticField:
                        "CASE WHEN (Compensation = 3 and CP = 'S-07') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07_compensation",
                    statisticType: "sum",
                };

                var query = treeLayer.createQuery();
                query.outStatistics = [
                    total_tree,
                    total_compensation,
                    total_s01,
                    total_s01_compensation,
                    total_s02,
                    total_s02_compensation,
                    total_s03a,
                    total_s03a_compensation,
                    total_s03b,
                    total_s03b_compensation,
                    total_s03c,
                    total_s03c_compensation,
                    total_s04,
                    total_s04_compensation,
                    total_s05,
                    total_s05_compensation,
                    total_s06,
                    total_s06_compensation,
                    total_s07,
                    total_s07_compensation,
                ];

                return treeLayer.queryFeatures(query).then(function (response) {
                    var stats = response.features[0].attributes;
                    const total = stats.total_tree;
                    const compensationd = stats.total_compensation;
                    const percent = (compensationd / total) * 100;

                    const s01_total = stats.total_s01;
                    const s02_total = stats.total_s02;
                    const s03a_total = stats.total_s03a;
                    const s03b_total = stats.total_s03b;
                    const s03c_total = stats.total_s03c;
                    const s04_total = stats.total_s04;
                    const s05_total = stats.total_s05;
                    const s06_total = stats.total_s06;
                    const s07_total = stats.total_s07;

                    const s01_total_compensation = stats.total_s01_compensation;
                    const s02_total_compensation = stats.total_s02_compensation;
                    const s03a_total_compensation = stats.total_s03a_compensation;
                    const s03b_total_compensation = stats.total_s03b_compensation;
                    const s03c_total_compensation = stats.total_s03c_compensation;
                    const s04_total_compensation = stats.total_s04_compensation;
                    const s05_total_compensation = stats.total_s05_compensation;
                    const s06_total_compensation = stats.total_s06_compensation;
                    const s07_total_compensation = stats.total_s07_compensation;

                    const s01_percent =
                        s01_total === 0 ? 0 : (s01_total_compensation / s01_total) * 100;
                    const s02_percent =
                        s02_total === 0 ? 0 : (s02_total_compensation / s02_total) * 100;
                    const s03a_percent =
                        s03a_total === 0 ? 0 : (s03a_total_compensation / s03a_total) * 100;
                    const s03b_percent =
                        s03b_total === 0 ? 0 : (s03b_total_compensation / s03b_total) * 100;
                    const s03c_percent =
                        s03c_total === 0 ? 0 : (s03c_total_compensation / s03c_total) * 100;
                    const s04_percent =
                        s04_total === 0 ? 0 : (s04_total_compensation / s04_total) * 100;
                    const s05_percent =
                        s05_total === 0 ? 0 : (s05_total_compensation / s05_total) * 100;
                    const s06_percent =
                        s06_total === 0 ? 0 : (s06_total_compensation / s06_total) * 100;
                    const s07_percent =
                        s07_total === 0 ? 0 : (s07_total_compensation / s07_total) * 100;

                    const s01_percent_total = (s01_total_compensation / total) * 100;
                    const s02_percent_total = (s02_total_compensation / total) * 100;
                    const s03a_percent_total = (s03a_total_compensation / total) * 100;
                    const s03b_percent_total = (s03b_total_compensation / total) * 100;
                    const s03c_percent_total = (s03c_total_compensation / total) * 100;
                    const s04_percent_total = (s04_total_compensation / total) * 100;
                    const s05_percent_total = (s05_total_compensation / total) * 100;
                    const s06_percent_total = (s06_total_compensation / total) * 100;
                    const s07_percent_total = (s07_total_compensation / total) * 100;

                    return [
                        total,
                        percent,
                        s01_percent,
                        s02_percent,
                        s03a_percent,
                        s03b_percent,
                        s03c_percent,
                        s04_percent,
                        s05_percent,
                        s06_percent,
                        s07_percent,
                        s01_percent_total,
                        s02_percent_total,
                        s03a_percent_total,
                        s03b_percent_total,
                        s03c_percent_total,
                        s04_percent_total,
                        s05_percent_total,
                        s06_percent_total,
                        s07_percent_total,
                    ];
                });
            } // End of treeCompenSummary function

            function chartTotalTreeCompensationCount([
                total,
                percent,
                s01_percent,
                s02_percent,
                s03a_percent,
                s03b_percent,
                s03c_percent,
                s04_percent,
                s05_percent,
                s06_percent,
                s07_percent,
                s01_percent_total,
                s02_percent_total,
                s03a_percent_total,
                s03b_percent_total,
                s03c_percent_total,
                s04_percent_total,
                s05_percent_total,
                s06_percent_total,
                s07_percent_total,
            ]) {
                var totalScore = percent;

                var S01 = s01_percent_total;
                var S02 = s01_percent_total + s02_percent_total;
                var S03a = s01_percent_total + s02_percent_total + s03a_percent_total;
                var S03b =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total;
                var S03c =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total;
                var S04 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total;
                var S05 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total;
                var S06 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total +
                    s06_percent_total;
                var S07 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total +
                    s06_percent_total +
                    s07_percent_total;

                var chartMin = 0;
                var chartMax = 100;

                // #ffea8c|#b3ab60|#4b595e|#6693c8|#aadbff
                // const colors = ["#ffea8c", "#b3ab60", "#4b595e", "#6693c8", "#aadbff"];

                var data = {
                    score: totalScore,
                    gradingData: [
                        {
                            title: s01_percent.toFixed(0),
                            color: color_101,
                            lowScore: 0,
                            highScore: S01,
                        },
                        {
                            title: s02_percent.toFixed(0),
                            color: color_102,
                            lowScore: S01,
                            highScore: S02,
                        },
                        {
                            title: s03a_percent.toFixed(0),
                            color: color_103a,
                            lowScore: S02,
                            highScore: S03a,
                        },
                        {
                            title: s03b_percent.toFixed(0),
                            color: color_103b,
                            lowScore: S03a,
                            highScore: S03b,
                        },
                        {
                            title: s03c_percent.toFixed(0),
                            color: color_103c,
                            lowScore: S03b,
                            highScore: S03c,
                        },
                        {
                            title: s04_percent.toFixed(0),
                            color: color_104,
                            lowScore: S03c,
                            highScore: S04,
                        },
                        {
                            title: s05_percent.toFixed(0),
                            color: color_105,
                            lowScore: S04,
                            highScore: S05,
                        },
                        {
                            title: s06_percent.toFixed(0),
                            color: color_106,
                            lowScore: S05,
                            highScore: S06,
                        },
                        {
                            title: s07_percent.toFixed(0),
                            color: color_107,
                            lowScore: S06,
                            highScore: S07,
                        },
                        {
                            title: "",
                            color: "#C5C5C5",
                            lowScore: S07,
                            highScore: 100,
                        },
                    ],
                };

                /**
            Grading Lookup
            */
                function lookUpGrade(lookupScore, grades) {
                    // Only change code below this line
                    for (var i = 0; i < grades.length; i++) {
                        if (
                            grades[i].lowScore < lookupScore &&
                            grades[i].highScore >= lookupScore
                        ) {
                            return grades[i];
                        }
                    }
                    return null;
                }

                // create chart
                var chart = am4core.create(
                    "treeCompenChartDiv",
                    am4charts.GaugeChart
                );
                chart.hiddenState.properties.opacity = 0;
                chart.fontSize = 11;
                chart.innerRadius = am4core.percent(80);
                chart.resizable = true;
                chart.responsive.enabled = true;
                chart.logo.disabled = true;
                /**
                 * Chart Title
                 */
                // Title Color
                var title = chart.titles.create();
                title.text = "TREE COMPENSATION";
                //title.html = '<a href="https://eijigorilla.github.io/WebApp/ArcGIS_API_for_JavaScript/envi/Operational/N2_Land_Structure2/index2.html" target="_blank">INFORMAL SETTLERS</a>';
                title.fontSize = titleFontSize;
                title.align = "center";
                title.marginBottom = -10;
                title.marginTop = 0;
                title.fill = TOP_TITLE_COL;

                // Add bottom label
                var label = chart.chartContainer.createChild(am4core.Label);
                label.text = "[bold]COMPENSATED";
                label.fontSize = bottomLabelFontSize;
                label.align = "center";
                label.marginTop = labelMarginTop;
                label.fill = BOTTOM_LABEL_COL;

                /**
                 * Normal axis
                 */

                var axis = chart.xAxes.push(new am4charts.ValueAxis());
                axis.min = chartMin;
                axis.max = chartMax;
                axis.strictMinMax = true;
                axis.renderer.radius = am4core.percent(80);
                axis.renderer.inside = true;
                axis.renderer.line.strokeOpacity = 0.5; // line opacity inside curve line
                axis.renderer.ticks.template.disabled = false;
                axis.renderer.ticks.template.strokeOpacity = 1;
                //axis.renderer.ticks.template.strokeWidth = 1;
                axis.renderer.ticks.template.length = 10;
                axis.renderer.ticks.template.stroke = am4core.color(axis1TickColor);
                //axis.renderer.grid.template.disabled = true;
                axis.renderer.labels.template.radius = am4core.percent(40);
                axis.renderer.labels.template.fontSize = "1.2em"; // default: 1.2em inner radius axis percent labels (0 to 100%)
                axis.renderer.labels.template.fill = am4core.color(axis1TickColor);

                /**
                 * Axis for ranges
                 */

                var axis2 = chart.xAxes.push(new am4charts.ValueAxis());
                axis2.min = chartMin;
                axis2.max = chartMax;
                axis2.strictMinMax = true;
                axis2.renderer.labels.template.disabled = true;
                axis2.renderer.ticks.template.disabled = true;
                axis2.renderer.grid.template.disabled = true; // when true inside tick marks will disappear
                axis2.renderer.grid.template.opacity = 0.5;
                axis2.renderer.labels.template.bent = true;
                axis2.renderer.labels.template.fill = am4core.color("#000");
                axis2.renderer.labels.template.fontWeight = "bold";
                axis2.renderer.labels.template.fillOpacity = 0.7;

                /**
          Ranges
          */

                for (let grading of data.gradingData) {
                    var range = axis2.axisRanges.create();
                    range.axisFill.fill = am4core.color(grading.color);
                    range.axisFill.fillOpacity = 1;
                    range.axisFill.zIndex = -1;
                    range.value =
                        grading.lowScore > chartMin ? grading.lowScore : chartMin;
                    range.endValue =
                        grading.highScore < chartMax ? grading.highScore : chartMax;
                    range.grid.strokeOpacity = 0; // changes opacity of inside tick mark
                    range.stroke = am4core.color(grading.color).lighten(-0.1);
                    range.label.inside = true;
                    range.label.text = grading.title.toUpperCase();
                    range.label.inside = true;
                    range.label.location = 0.5;
                    range.label.inside = true;
                    range.label.radius = am4core.percent(10);
                    range.label.paddingBottom = -5; // ~half font size
                    range.label.fontSize = "1.4em"; // category label (i.e., N-01, N-02, ....)
                }

                var matchingGrade = lookUpGrade(data.score, data.gradingData);

                /**
                 * Label 1 (total Percent)
                 */

                var label = chart.radarContainer.createChild(am4core.Label);
                label.isMeasured = false;
                label.fontSize = totalPercentLabel_fontSize;
                label.x = am4core.percent(50);
                label.y = totalPercentLabel_y;
                label.paddingBottom = -5;
                label.horizontalCenter = "middle";
                label.verticalCenter = "bottom";

                //label.dataItem = data;
                label.wrap = true;
                label.text = data.score.toFixed(0).toString() + "%";
                //label.text = "{score}";
                //label.fill = am4core.color(matchingGrade.color);
                label.fill = am4core.color("#00C3FF");

                /**
                 * Label 2
                 */

                var label2 = chart.radarContainer.createChild(am4core.Label);
                label2.isMeasured = false;
                label2.fontSize = totalNumberLabel_fontSize;
                label2.horizontalCenter = "middle";
                label2.verticalCenter = "bottom";
                label2.y = totalNumberLabel_y;
                label2.text = "(" + thousands_separators(total) + ")";
                label2.fill = am4core.color("#00C3FF");

                /**
                 * Hand
                 */

                var hand = chart.hands.push(new am4charts.ClockHand());
                hand.axis = axis2;
                hand.innerRadius = am4core.percent(55);
                hand.startWidth = 8;
                hand.pin.disabled = true;
                hand.value = data.score;
                hand.fill = am4core.color("#000000"); // inner color of needle
                //hand.stroke = am4core.color("#000");
                hand.fillOpacity = 0.5;
            }
            totalTreeCompensationCount().then(chartTotalTreeCompensationCount);



            /////////// Utility Point + Line Total Number ////////////////


            async function utilityTotalCount() {

                /// Point
                var total_number_point = {
                    onStatisticField: "LAYER",
                    outStatisticFieldName: "total_number_point",
                    statisticType: "count",
                };

                var total_completed_point = {
                    onStatisticField: "CASE WHEN Status = 1 THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_completed_point",
                    statisticType: "sum",
                };

                var total_s01_point = {
                    onStatisticField: "CASE WHEN CP = 'S-01' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01_point",
                    statisticType: "sum",
                };

                var total_s01_completed_point = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-01') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01_completed_point",
                    statisticType: "sum",
                };

                var total_s02_point = {
                    onStatisticField: "CASE WHEN CP = 'S-02' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02_point",
                    statisticType: "sum",
                };

                var total_s02_completed_point = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-02') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02_completed_point",
                    statisticType: "sum",
                };

                var total_s03a_point = {
                    onStatisticField: "CASE WHEN CP = 'S-03a' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a_point",
                    statisticType: "sum",
                };

                var total_s03a_completed_point = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-03a') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a_completed_point",
                    statisticType: "sum",
                };

                var total_s03b_point = {
                    onStatisticField: "CASE WHEN CP = 'S-03b' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b_point",
                    statisticType: "sum",
                };

                var total_s03b_completed_point = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-03b') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b_completed_point",
                    statisticType: "sum",
                };

                var total_s03c_point = {
                    onStatisticField: "CASE WHEN CP = 'S-03c' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c_point",
                    statisticType: "sum",
                };

                var total_s03c_completed_point = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-03c') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c_completed_point",
                    statisticType: "sum",
                };

                var total_s04_point = {
                    onStatisticField: "CASE WHEN CP = 'S-04' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04_point",
                    statisticType: "sum",
                };

                var total_s04_completed_point = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-04') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04_completed_point",
                    statisticType: "sum",
                };

                var total_s05_point = {
                    onStatisticField: "CASE WHEN CP = 'S-05' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05_point",
                    statisticType: "sum",
                };

                var total_s05_completed_point = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-05') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05_completed_point",
                    statisticType: "sum",
                };

                var total_s06_point = {
                    onStatisticField: "CASE WHEN CP = 'S-06' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06_point",
                    statisticType: "sum",
                };

                var total_s06_completed_point = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-06') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06_completed_point",
                    statisticType: "sum",
                };

                var total_s07_point = {
                    onStatisticField: "CASE WHEN CP = 'S-07' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07_point",
                    statisticType: "sum",
                };

                var total_s07_completed_point = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-07') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07_completed_point",
                    statisticType: "sum",
                };


                /// Line
                var total_number_line = {
                    onStatisticField: "LAYER",
                    outStatisticFieldName: "total_number_line",
                    statisticType: "count",
                };

                var total_completed_line = {
                    onStatisticField: "CASE WHEN Status = 1 THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_completed_line",
                    statisticType: "sum",
                };

                var total_s01_line = {
                    onStatisticField: "CASE WHEN CP = 'S-01' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01_line",
                    statisticType: "sum",
                };

                var total_s01_completed_line = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-01') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s01_completed_line",
                    statisticType: "sum",
                };

                var total_s02_line = {
                    onStatisticField: "CASE WHEN CP = 'S-02' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02_line",
                    statisticType: "sum",
                };

                var total_s02_completed_line = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-02') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s02_completed_line",
                    statisticType: "sum",
                };

                var total_s03a_line = {
                    onStatisticField: "CASE WHEN CP = 'S-03a' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a_line",
                    statisticType: "sum",
                };

                var total_s03a_completed_line = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-03a') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03a_completed_line",
                    statisticType: "sum",
                };

                var total_s03b_line = {
                    onStatisticField: "CASE WHEN CP = 'S-03b' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b_line",
                    statisticType: "sum",
                };

                var total_s03b_completed_line = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-03b') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03b_completed_line",
                    statisticType: "sum",
                };

                var total_s03c_line = {
                    onStatisticField: "CASE WHEN CP = 'S-03c' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c_line",
                    statisticType: "sum",
                };

                var total_s03c_completed_line = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-03c') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s03c_completed_line",
                    statisticType: "sum",
                };

                var total_s04_line = {
                    onStatisticField: "CASE WHEN CP = 'S-04' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04_line",
                    statisticType: "sum",
                };

                var total_s04_completed_line = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-04') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s04_completed_line",
                    statisticType: "sum",
                };

                var total_s05_line = {
                    onStatisticField: "CASE WHEN CP = 'S-05' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05_line",
                    statisticType: "sum",
                };

                var total_s05_completed_line = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-05') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s05_completed_line",
                    statisticType: "sum",
                };

                var total_s06_line = {
                    onStatisticField: "CASE WHEN CP = 'S-06' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06_line",
                    statisticType: "sum",
                };

                var total_s06_completed_line = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-06') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s06_completed_line",
                    statisticType: "sum",
                };

                var total_s07_line = {
                    onStatisticField: "CASE WHEN CP = 'S-07' THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07_line",
                    statisticType: "sum",
                };

                var total_s07_completed_line = {
                    onStatisticField:
                        "CASE WHEN (Status = 1 and CP = 'S-07') THEN 1 ELSE 0 END",
                    outStatisticFieldName: "total_s07_completed_line",
                    statisticType: "sum",
                };


                var query_p = utilPointLayer.createQuery();
                query_p.outStatistics = [
                    total_number_point,
                    total_completed_point,
                    total_s01_point,
                    total_s01_completed_point,
                    total_s02_point,
                    total_s02_completed_point,
                    total_s03a_point,
                    total_s03a_completed_point,
                    total_s03b_point,
                    total_s03b_completed_point,
                    total_s03c_point,
                    total_s03c_completed_point,
                    total_s04_point,
                    total_s04_completed_point,
                    total_s05_point,
                    total_s05_completed_point,
                    total_s06_point,
                    total_s06_completed_point,
                    total_s07_point,
                    total_s07_completed_point,
                ];

                const pointCompile = utilPointLayer.queryFeatures(query_p).then(function (response) {
                    var stats = response.features[0].attributes;

                    const total_point = stats.total_number_point;
                    const total_comp_point = stats.total_completed_point;
                    const total_s01_point = stats.total_s01_point;
                    const total_s01_comp_point = stats.total_s01_completed_point;
                    const total_s02_point = stats.total_s02_point;
                    const total_s02_comp_point = stats.total_s02_completed_point;
                    const total_s03a_point = stats.total_s03a_point;
                    const total_s03a_comp_point = stats.total_s03a_completed_point;
                    const total_s03b_point = stats.total_s03b_point;
                    const total_s03b_comp_point = stats.total_s03b_completed_point;
                    const total_s03c_point = stats.total_s03c_point;
                    const total_s03c_comp_point = stats.total_s03c_completed_point;
                    const total_s04_point = stats.total_s04_point;
                    const total_s04_comp_point = stats.total_s04_completed_point;
                    const total_s05_point = stats.total_s05_point;
                    const total_s05_comp_point = stats.total_s05_completed_point;
                    const total_s06_point = stats.total_s06_point;
                    const total_s06_comp_point = stats.total_s06_completed_point;
                    const total_s07_point = stats.total_s07_point;
                    const total_s07_comp_point = stats.total_s07_completed_point;

                    return [
                        total_point,
                        total_comp_point,
                        total_s01_point,
                        total_s01_comp_point,
                        total_s02_point,
                        total_s02_comp_point,
                        total_s03a_point,
                        total_s03a_comp_point,
                        total_s03b_point,
                        total_s03b_comp_point,
                        total_s03c_point,
                        total_s03c_comp_point,
                        total_s04_point,
                        total_s04_comp_point,
                        total_s05_point,
                        total_s05_comp_point,
                        total_s06_point,
                        total_s06_comp_point,
                        total_s07_point,
                        total_s07_comp_point,
                    ];
                });


                var query_l = utilLineLayer.createQuery();
                query_l.outStatistics = [
                    total_number_line,
                    total_completed_line,
                    total_s01_line,
                    total_s01_completed_line,
                    total_s02_line,
                    total_s02_completed_line,
                    total_s03a_line,
                    total_s03a_completed_line,
                    total_s03b_line,
                    total_s03b_completed_line,
                    total_s03c_line,
                    total_s03c_completed_line,
                    total_s04_line,
                    total_s04_completed_line,
                    total_s05_line,
                    total_s05_completed_line,
                    total_s06_line,
                    total_s06_completed_line,
                    total_s07_line,
                    total_s07_completed_line,
                ];

                const lineCompile = utilLineLayer.queryFeatures(query_l).then(function (response) {
                    var stats = response.features[0].attributes;
                    const total_line = stats.total_number_line;
                    const total_comp_line = stats.total_completed_line;
                    const total_s01_line = stats.total_s01_line;
                    const total_s01_comp_line = stats.total_s01_completed_line;
                    const total_s02_line = stats.total_s02_line;
                    const total_s02_comp_line = stats.total_s02_completed_line;
                    const total_s03a_line = stats.total_s03a_line;
                    const total_s03a_comp_line = stats.total_s03a_completed_line;
                    const total_s03b_line = stats.total_s03b_line;
                    const total_s03b_comp_line = stats.total_s03b_completed_line;
                    const total_s03c_line = stats.total_s03c_line;
                    const total_s03c_comp_line = stats.total_s03c_completed_line;
                    const total_s04_line = stats.total_s04_line;
                    const total_s04_comp_line = stats.total_s04_completed_line;
                    const total_s05_line = stats.total_s05_line;
                    const total_s05_comp_line = stats.total_s05_completed_line;
                    const total_s06_line = stats.total_s06_line;
                    const total_s06_comp_line = stats.total_s06_completed_line;
                    const total_s07_line = stats.total_s07_line;
                    const total_s07_comp_line = stats.total_s07_completed_line;


                    return [
                        total_line,
                        total_comp_line,
                        total_s01_line,
                        total_s01_comp_line,
                        total_s02_line,
                        total_s02_comp_line,
                        total_s03a_line,
                        total_s03a_comp_line,
                        total_s03b_line,
                        total_s03b_comp_line,
                        total_s03c_line,
                        total_s03c_comp_line,
                        total_s04_line,
                        total_s04_comp_line,
                        total_s05_line,
                        total_s05_comp_line,
                        total_s06_line,
                        total_s06_comp_line,
                        total_s07_line,
                        total_s07_comp_line,
                    ];
                });

                const point = await pointCompile;
                const line = await lineCompile;

                const total = point[0] + line[0];
                const total_comp = point[1] + line[1];
                const total_s01 = point[2] + line[2];
                const total_s01_comp = point[3] + line[3];
                const total_s02 = point[4] + line[4];
                const total_s02_comp = point[5] + line[5];
                const total_s03a = point[6] + line[6];
                const total_s03a_comp = point[7] + line[7];
                const total_s03b = point[8] + line[8];
                const total_s03b_comp = point[9] + line[9];
                const total_s03c = point[10] + line[10];
                const total_s03c_comp = point[11] + line[11];
                const total_s04 = point[12] + line[12];
                const total_s04_comp = point[13] + line[13];
                const total_s05 = point[14] + line[14];
                const total_s05_comp = point[15] + line[15];
                const total_s06 = point[16] + line[16];
                const total_s06_comp = point[17] + line[17];
                const total_s07 = point[18] + line[18];
                const total_s07_comp = point[19] + line[19];

                const total_percent = (total_comp / total) * 100;
                const s01_percent = (total_s01_comp / total_s01) * 100;
                const s02_percent = (total_s02_comp / total_s02) * 100;
                const s03a_percent = (total_s03a_comp / total_s03a) * 100;
                const s03b_percent = (total_s03b_comp / total_s03b) * 100;
                const s03c_percent = (total_s03c_comp / total_s03c) * 100;
                const s04_percent = (total_s04_comp / total_s04) * 100;
                const s05_percent = (total_s05_comp / total_s05) * 100;
                const s06_percent = (total_s06_comp / total_s06) * 100;
                const s07_percent = (total_s07_comp / total_s07) * 100;

                const s01_percent_total = (total_s01_comp / total) * 100;
                const s02_percent_total = (total_s02_comp / total) * 100;
                const s03a_percent_total = (total_s03a_comp / total) * 100;
                const s03b_percent_total = (total_s03b_comp / total) * 100;
                const s03c_percent_total = (total_s03c_comp / total) * 100;
                const s04_percent_total = (total_s04_comp / total) * 100;
                const s05_percent_total = (total_s05_comp / total) * 100;
                const s06_percent_total = (total_s06_comp / total) * 100;
                const s07_percent_total = (total_s07_comp / total) * 100;

                return [
                    total,
                    total_percent,
                    s01_percent,
                    s02_percent,
                    s03a_percent,
                    s03b_percent,
                    s03c_percent,
                    s04_percent,
                    s05_percent,
                    s06_percent,
                    s07_percent,
                    s01_percent_total,
                    s02_percent_total,
                    s03a_percent_total,
                    s03b_percent_total,
                    s03c_percent_total,
                    s04_percent_total,
                    s05_percent_total,
                    s06_percent_total,
                    s07_percent_total,
                ];
            }


            // Utility Progress Chart
            function utilityChart([
                total,
                percent,
                s01_percent,
                s02_percent,
                s03a_percent,
                s03b_percent,
                s03c_percent,
                s04_percent,
                s05_percent,
                s06_percent,
                s07_percent,
                s01_percent_total,
                s02_percent_total,
                s03a_percent_total,
                s03b_percent_total,
                s03c_percent_total,
                s04_percent_total,
                s05_percent_total,
                s06_percent_total,
                s07_percent_total,
            ]) {
                var totalScore = percent;

                var S01 = s01_percent_total;
                var S02 = s01_percent_total + s02_percent_total;
                var S03a = s01_percent_total + s02_percent_total + s03a_percent_total;
                var S03b =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total;
                var S03c =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total;
                var S04 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total;
                var S05 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total;
                var S06 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total +
                    s06_percent_total;
                var S07 =
                    s01_percent_total +
                    s02_percent_total +
                    s03a_percent_total +
                    s03b_percent_total +
                    s03c_percent_total +
                    s04_percent_total +
                    s05_percent_total +
                    s06_percent_total +
                    s07_percent_total;

                var chartMin = 0;
                var chartMax = 100;

                // #ffea8c|#b3ab60|#4b595e|#6693c8|#aadbff
                // const colors = ["#ffea8c", "#b3ab60", "#4b595e", "#6693c8", "#aadbff"];

                var data = {
                    score: totalScore,
                    gradingData: [
                        {
                            title: s01_percent.toFixed(0),
                            color: color_101,
                            lowScore: 0,
                            highScore: S01,
                        },
                        {
                            title: s02_percent.toFixed(0),
                            color: color_102,
                            lowScore: S01,
                            highScore: S02,
                        },
                        {
                            title: s03a_percent.toFixed(0),
                            color: color_103a,
                            lowScore: S02,
                            highScore: S03a,
                        },
                        {
                            title: s03b_percent.toFixed(0),
                            color: color_103b,
                            lowScore: S03a,
                            highScore: S03b,
                        },
                        {
                            title: s03c_percent.toFixed(0),
                            color: color_103c,
                            lowScore: S03b,
                            highScore: S03c,
                        },
                        {
                            title: s04_percent.toFixed(0),
                            color: color_104,
                            lowScore: S03c,
                            highScore: S04,
                        },
                        {
                            title: s05_percent.toFixed(0),
                            color: color_105,
                            lowScore: S04,
                            highScore: S05,
                        },
                        {
                            title: s06_percent.toFixed(0),
                            color: color_106,
                            lowScore: S05,
                            highScore: S06,
                        },
                        {
                            title: s07_percent.toFixed(0),
                            color: color_107,
                            lowScore: S06,
                            highScore: S07,
                        },
                        {
                            title: "",
                            color: "#C5C5C5",
                            lowScore: S07,
                            highScore: 100,
                        },
                    ],
                };

                /**
          Grading Lookup
          */
                function lookUpGrade(lookupScore, grades) {
                    // Only change code below this line
                    for (var i = 0; i < grades.length; i++) {
                        if (
                            grades[i].lowScore < lookupScore &&
                            grades[i].highScore >= lookupScore
                        ) {
                            return grades[i];
                        }
                    }
                    return null;
                }

                // create chart
                var chart = am4core.create(
                    "utilityPointChartDiv",
                    am4charts.GaugeChart
                );
                chart.hiddenState.properties.opacity = 0;
                chart.fontSize = 11;
                chart.innerRadius = am4core.percent(80);
                chart.resizable = true;
                chart.responsive.enabled = true;
                chart.logo.disabled = true;
                /**
                 * Chart Title
                 */
                // Title Color
                var title = chart.titles.create();
                title.text = "UTILITY";
                //title.html = '<a href="https://eijigorilla.github.io/WebApp/ArcGIS_API_for_JavaScript/envi/Operational/N2_Land_Structure2/index2.html" target="_blank">INFORMAL SETTLERS</a>';
                title.fontSize = titleFontSize;
                title.align = "center";
                title.marginBottom = -10;
                title.marginTop = 0;
                title.fill = TOP_TITLE_COL;

                // Add bottom label
                var label = chart.chartContainer.createChild(am4core.Label);
                label.text = "[bold]COMPLETED";
                label.fontSize = bottomLabelFontSize;
                label.align = "center";
                label.marginTop = labelMarginTop;
                label.fill = BOTTOM_LABEL_COL;

                /**
                 * Normal axis
                 */

                var axis = chart.xAxes.push(new am4charts.ValueAxis());
                axis.min = chartMin;
                axis.max = chartMax;
                axis.strictMinMax = true;
                axis.renderer.radius = am4core.percent(80);
                axis.renderer.inside = true;
                axis.renderer.line.strokeOpacity = 0.5; // line opacity inside curve line
                axis.renderer.ticks.template.disabled = false;
                axis.renderer.ticks.template.strokeOpacity = 1;
                //axis.renderer.ticks.template.strokeWidth = 1;
                axis.renderer.ticks.template.length = 10;
                axis.renderer.ticks.template.stroke = am4core.color(axis1TickColor);
                //axis.renderer.grid.template.disabled = true;
                axis.renderer.labels.template.radius = am4core.percent(40);
                axis.renderer.labels.template.fontSize = "1.2em"; // default: 1.2em inner radius axis percent labels (0 to 100%)
                axis.renderer.labels.template.fill = am4core.color(axis1TickColor);

                /**
                 * Axis for ranges
                 */

                var axis2 = chart.xAxes.push(new am4charts.ValueAxis());
                axis2.min = chartMin;
                axis2.max = chartMax;
                axis2.strictMinMax = true;
                axis2.renderer.labels.template.disabled = true;
                axis2.renderer.ticks.template.disabled = true;
                axis2.renderer.grid.template.disabled = true; // when true inside tick marks will disappear
                axis2.renderer.grid.template.opacity = 0.5;
                axis2.renderer.labels.template.bent = true;
                axis2.renderer.labels.template.fill = am4core.color("#000");
                axis2.renderer.labels.template.fontWeight = "bold";
                axis2.renderer.labels.template.fillOpacity = 0.7;

                /**
          Ranges
          */

                for (let grading of data.gradingData) {
                    var range = axis2.axisRanges.create();
                    range.axisFill.fill = am4core.color(grading.color);
                    range.axisFill.fillOpacity = 1;
                    range.axisFill.zIndex = -1;
                    range.value =
                        grading.lowScore > chartMin ? grading.lowScore : chartMin;
                    range.endValue =
                        grading.highScore < chartMax ? grading.highScore : chartMax;
                    range.grid.strokeOpacity = 0; // changes opacity of inside tick mark
                    range.stroke = am4core.color(grading.color).lighten(-0.1);
                    range.label.inside = true;
                    range.label.text = grading.title.toUpperCase();
                    range.label.inside = true;
                    range.label.location = 0.5;
                    range.label.inside = true;
                    range.label.radius = am4core.percent(10);
                    range.label.paddingBottom = -5; // ~half font size
                    range.label.fontSize = "1.4em"; // category label (i.e., N-01, N-02, ....)
                }

                var matchingGrade = lookUpGrade(data.score, data.gradingData);

                /**
                 * Label 1 (total Percent)
                 */

                var label = chart.radarContainer.createChild(am4core.Label);
                label.isMeasured = false;
                label.fontSize = totalPercentLabel_fontSize;
                label.x = am4core.percent(50);
                label.y = totalPercentLabel_y;
                label.paddingBottom = -5;
                label.horizontalCenter = "middle";
                label.verticalCenter = "bottom";

                //label.dataItem = data;
                label.wrap = true;
                label.text = data.score.toFixed(0).toString() + "%";
                //label.text = "{score}";
                //label.fill = am4core.color(matchingGrade.color);
                label.fill = am4core.color("#00C3FF");

                /**
                 * Label 2
                 */

                var label2 = chart.radarContainer.createChild(am4core.Label);
                label2.isMeasured = false;
                label2.fontSize = totalNumberLabel_fontSize;
                label2.horizontalCenter = "middle";
                label2.verticalCenter = "bottom";
                label2.y = totalNumberLabel_y;
                label2.text = "(" + thousands_separators(total) + ")";
                label2.fill = am4core.color("#00C3FF");

                /**
                 * Hand
                 */

                var hand = chart.hands.push(new am4charts.ClockHand());
                hand.axis = axis2;
                hand.innerRadius = am4core.percent(55);
                hand.startWidth = 8;
                hand.pin.disabled = true;
                hand.value = data.score;
                hand.fill = am4core.color("#000000"); // inner color of needle
                //hand.stroke = am4core.color("#000");
                hand.fillOpacity = 0.5;
            }
            utilityTotalCount().then(utilityChart);
        }); // end am4core.ready()
    });
</script>

</html>